{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _defineProperty from\"/home/mfybaby/Documents/HealthStack2/HS-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/home/mfybaby/Documents/HealthStack2/HS-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/home/mfybaby/Documents/HealthStack2/HS-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/mfybaby/Documents/HealthStack2/HS-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/mfybaby/Documents/HealthStack2/HS-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";/* eslint-disable */import React,{useState,useContext,useEffect,useRef}from'react';import client from'../../feathers';import{DebounceInput}from'react-debounce-input';import{useForm}from\"react-hook-form\";//import {DocumentClassList} from './DocumentClass'\n//import {useHistory} from 'react-router-dom'\nimport{UserContext,ObjectContext}from'../../context';import{toast}from'bulma-toast';import{format,formatDistanceToNowStrict}from'date-fns';import VideoConference from'../utils/VideoConference';/* import  Prescription, { PrescriptionCreate } from './Prescription'; */export default function DispensaryMain(){// const { register, handleSubmit, watch, errors } = useForm();\n// eslint-disable-next-line\nvar _useState=useState(false),_useState2=_slicedToArray(_useState,2),error=_useState2[0],setError=_useState2[1];// eslint-disable-next-line\nvar _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),success=_useState4[0],setSuccess=_useState4[1];// eslint-disable-next-line\nvar _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),message=_useState6[0],setMessage=_useState6[1];var ClinicServ=client.service('clinicaldocument');//const history = useHistory()\n// const {user,setUser} = useContext(UserContext)\nvar _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),facilities=_useState8[0],setFacilities=_useState8[1];// eslint-disable-next-line\nvar _useState9=useState(),_useState10=_slicedToArray(_useState9,2),selectedClinic=_useState10[0],setSelectedClinic=_useState10[1];//\n// eslint-disable-next-line\nvar _useContext=useContext(ObjectContext),state=_useContext.state,setState=_useContext.setState;// eslint-disable-next-line\nvar _useContext2=useContext(UserContext),user=_useContext2.user,setUser=_useContext2.setUser;var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),showModal=_useState12[0],setShowModal=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),showPrescriptionModal=_useState14[0],setShowPrescriptionModal=_useState14[1];// tracking on which page we currently are\nvar _useState15=useState(0),_useState16=_slicedToArray(_useState15,2),page=_useState16[0],setPage=_useState16[1];// add loader refrence \nvar loader=useRef(null);var standalone=false;var handleNewDocument=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return setShowModal(true);case 2:console.log(showModal);case 3:case\"end\":return _context.stop();}}},_callee);}));return function handleNewDocument(){return _ref.apply(this,arguments);};}();var handleNewPrescription=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return setShowPrescriptionModal(true);case 2:console.log(showPrescriptionModal);case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function handleNewPrescription(){return _ref2.apply(this,arguments);};}();var handleCreateNew=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var newClinicModule;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:newClinicModule={selectedClinic:{},show:'create'};_context3.next=3;return setState(function(prevstate){return _objectSpread(_objectSpread({},prevstate),{},{ClinicModule:newClinicModule});});case 3:case\"end\":return _context3.stop();}}},_callee3);}));return function handleCreateNew(){return _ref3.apply(this,arguments);};}();var handleRow=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(Clinic){var newClinicModule;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return setSelectedClinic(Clinic);case 2:newClinicModule={selectedClinic:Clinic,show:'detail'};_context4.next=5;return setState(function(prevstate){return _objectSpread(_objectSpread({},prevstate),{},{ClinicModule:newClinicModule});});case 5://console.log(state)\nClinic.show=!Clinic.show;case 6:case\"end\":return _context4.stop();}}},_callee4);}));return function handleRow(_x){return _ref4.apply(this,arguments);};}();var handleSearch=function handleSearch(val){var _query;var field='documentname';console.log(val);ClinicServ.find({query:(_query={},_defineProperty(_query,field,{$regex:val,$options:'i'}),_defineProperty(_query,\"client\",state.ClientModule.selectedClient._id),_defineProperty(_query,\"$limit\",10),_defineProperty(_query,\"$sort\",{name:1}),_query)}).then(function(res){console.log(res);setFacilities(res.data);setMessage(\" Clinic  fetched successfully\");setSuccess(true);}).catch(function(err){console.log(err);setMessage(\"Error fetching Clinic, probable network issues \"+err);setError(true);});};var getFacilities=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){var page,findClinic,total,ulimit,_findClinic,_args5=arguments;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:page=_args5.length>0&&_args5[0]!==undefined?_args5[0]:0;if(!user.currentEmployee){_context5.next=12;break;}_context5.next=4;return ClinicServ.find({query:{//locationType:\"Clinic\",\n//facility:user.currentEmployee.facilityDetail._id,\nclient:state.ClientModule.selectedClient._id,$limit:20,/*  $skip:page*limit, */$sort:{createdAt:-1}}});case 4:findClinic=_context5.sent;total=findClinic.total;ulimit=total*page;/*  if (total>(ulimit)){ //only load if we have not reached the total\n                alert(\"skip:\",ulimit )\n                console.log(\"skip:\",ulimit ) */_context5.next=9;return setFacilities(findClinic.data);case 9:console.log(findClinic.data);/*  } */_context5.next=18;break;case 12:if(!user.stacker){_context5.next=18;break;}_context5.next=15;return ClinicServ.find({query:{client:state.ClientModule.selectedClient._id,$limit:20,$sort:{createdAt:-1}}});case 15:_findClinic=_context5.sent;_context5.next=18;return setFacilities(_findClinic.data);case 18:case\"end\":return _context5.stop();}}},_callee5);}));return function getFacilities(){return _ref5.apply(this,arguments);};}();useEffect(function(){getFacilities();if(user){}else{/* const localUser= localStorage.getItem(\"user\")\n                    const user1=JSON.parse(localUser)\n                    console.log(localUser)\n                    console.log(user1)\n                    fetchUser(user1)\n                    console.log(user)\n                    getFacilities(user) */}ClinicServ.on('created',function(obj){return getFacilities(page);});ClinicServ.on('updated',function(obj){return getFacilities(page);});ClinicServ.on('patched',function(obj){return getFacilities(page);});ClinicServ.on('removed',function(obj){return getFacilities(page);});/* var options = {\n                    root: null,\n                    rootMargin: \"20px\",\n                    threshold: 1.0\n                 }; */ // initialize IntersectionObserver\n// and attaching to Load More div\n/*  const observer = new IntersectionObserver(handleObserver, options);\n                 if (loader.current) {\n                    observer.observe(loader.current)\n                 } */return function(){};},[]);/*  useEffect(() => {\n                // here we simulate adding new posts to List\n                getFacilities()\n            }, [page]) */ // here we handle what happens when user scrolls to Load More div\n// in this case we just update page variable\n/* const handleObserver = (entities) => {\n                    const target = entities[0];\n                    if (target.isIntersecting) {   \n                        setPage((page) => page + 1) //load more \n                        \n                    }\n                } */return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(VideoConference,{}),/*#__PURE__*/_jsxs(\"div\",{className:\"level\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"level-left\",children:/*#__PURE__*/_jsx(\"div\",{className:\"level-item\",children:/*#__PURE__*/_jsx(\"div\",{className:\"field\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"control has-icons-left  \",children:[/*#__PURE__*/_jsx(DebounceInput,{className:\"input is-small \",type:\"text\",placeholder:\"Search documentation\",minLength:3,debounceTimeout:400,onChange:function onChange(e){return handleSearch(e.target.value);}}),/*#__PURE__*/_jsx(\"span\",{className:\"icon is-small is-left\",children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-search\"})})]})})})}),/*#__PURE__*/_jsx(\"div\",{className:\"level-right\",children:!standalone&&/*#__PURE__*/_jsx(\"div\",{className:\"level-item\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"level-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"button is-danger is-small mr-2\",onClick:handleNewPrescription,children:\"Presciption\"}),/*#__PURE__*/_jsx(\"div\",{className:\"button is-success is-small\",onClick:handleNewDocument,children:\"New Document\"})]})})})]}),/*#__PURE__*/_jsx(\"div\",{className:\" pullup \",children:/*#__PURE__*/_jsx(\"div\",{className:\" is-fullwidth vscrollable pr-1\",children:facilities.map(function(Clinic,i){return/*#__PURE__*/_jsx(\"div\",{onClick:function onClick(){return handleRow(Clinic);},className:Clinic._id===((selectedClinic===null||selectedClinic===void 0?void 0:selectedClinic._id)||null)?\"is-selected\":\"\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"card mt-1 hovercard\",children:[/*#__PURE__*/_jsx(\"header\",{className:\"card-header\",onClick:function onClick(Clinic){return Clinic.show=!Clinic.show;},children:/*#__PURE__*/_jsxs(\"div\",{className:\"card-header-title\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"docdate\",children:[formatDistanceToNowStrict(new Date(Clinic.createdAt),{addSuffix:true}),\" \",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"span\",{children:format(new Date(Clinic.createdAt),'dd-MM-yy')})]}),\" \",Clinic.documentname,\" by \",Clinic.createdByname,\" at \",Clinic.location,\",\",Clinic.facilityname,/*#__PURE__*/_jsxs(\"p\",{className:\"right ml-2 mr-0\",children:[Clinic.status,\" \"]})]})}),Clinic.documentname!==\"Prescription\"&&/*#__PURE__*/_jsx(\"div\",{className:Clinic.show?\"card-content p-1\":\"card-content p-1 is-hidden\",children:Object.entries(Clinic.documentdetail).map(function(_ref6,i){var _ref7=_slicedToArray(_ref6,2),keys=_ref7[0],value=_ref7[1];return/*#__PURE__*/_jsxs(\"div\",{className:\"field is-horizontal\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"field-label\",children:/*#__PURE__*/_jsxs(\"label\",{className:\"label is-size-7\",children:[keys,\":\"]},i)}),/*#__PURE__*/_jsx(\"div\",{className:\"field-body\",children:/*#__PURE__*/_jsx(\"div\",{className:\"field\",children:value})})]});})}),Clinic.documentname===\"Prescription\"&&/*#__PURE__*/_jsx(\"div\",{className:Clinic.show?\"card-content p-1\":\"card-content p-1 is-hidden\",children:Clinic.documentdetail.length>0&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Medications:\"}),/*#__PURE__*/_jsxs(\"table\",{className:\"table is-striped  is-hoverable is-fullwidth is-scrollable mr-2\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:/*#__PURE__*/_jsx(\"abbr\",{title:\"Serial No\",children:\"S/No\"})}),/*#__PURE__*/_jsx(\"th\",{children:/*#__PURE__*/_jsx(\"abbr\",{title:\"Type\",children:\"Medication\"})}),/*#__PURE__*/_jsx(\"th\",{children:/*#__PURE__*/_jsx(\"abbr\",{title:\"Destination\",children:\"Destination\"})})]})}),/*#__PURE__*/_jsx(\"tfoot\",{}),/*#__PURE__*/_jsx(\"tbody\",{children:Clinic.documentdetail.map(function(ProductEntry,i){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:i+1}),/*#__PURE__*/_jsxs(\"td\",{children:[ProductEntry.medication,/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"span\",{className:\"help is-size-7\",children:ProductEntry.instruction})]}),/*#__PURE__*/_jsx(\"td\",{children:ProductEntry.destination})]},i);})})]})]})})]})},Clinic._id);})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal  \".concat(showModal?\"is-active\":\"\"),children:[/*#__PURE__*/_jsx(\"div\",{className:\"modal-background\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-card \",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"modal-card-head\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"modal-card-title\",children:\"Choose Document Class\"}),/*#__PURE__*/_jsx(\"button\",{className:\"delete\",\"aria-label\":\"close\",onClick:function onClick(){return setShowModal(false);}})]}),/*#__PURE__*/_jsx(\"section\",{className:\"modal-card-body\",children:/*#__PURE__*/_jsx(DocumentClassList,{standalone:\"true\"})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal \".concat(showPrescriptionModal?\"is-active\":\"\"),children:[/*#__PURE__*/_jsx(\"div\",{className:\"modal-background\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-card larger\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"modal-card-head\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"modal-card-title\",children:\"Prescription\"}),/*#__PURE__*/_jsx(\"button\",{className:\"delete\",\"aria-label\":\"close\",onClick:function onClick(){return setShowPrescriptionModal(false);}})]}),/*#__PURE__*/_jsx(\"section\",{className:\"modal-card-body\",children:/*#__PURE__*/_jsx(Prescription,{standalone:\"true\"})})]})]})]});}","map":{"version":3,"sources":["/home/mfybaby/Documents/HealthStack2/HS-frontend/src/components/ManagedCare/Checkin.js"],"names":["React","useState","useContext","useEffect","useRef","client","DebounceInput","useForm","UserContext","ObjectContext","toast","format","formatDistanceToNowStrict","VideoConference","DispensaryMain","error","setError","success","setSuccess","message","setMessage","ClinicServ","service","facilities","setFacilities","selectedClinic","setSelectedClinic","state","setState","user","setUser","showModal","setShowModal","showPrescriptionModal","setShowPrescriptionModal","page","setPage","loader","standalone","handleNewDocument","console","log","handleNewPrescription","handleCreateNew","newClinicModule","show","prevstate","ClinicModule","handleRow","Clinic","handleSearch","val","field","find","query","$regex","$options","ClientModule","selectedClient","_id","name","then","res","data","catch","err","getFacilities","currentEmployee","$limit","$sort","createdAt","findClinic","total","ulimit","stacker","on","obj","e","target","value","map","i","Date","addSuffix","documentname","createdByname","location","facilityname","status","Object","entries","documentdetail","keys","length","ProductEntry","medication","instruction","destination"],"mappings":"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","sourcesContent":["/* eslint-disable */\nimport React, {useState,useContext, useEffect,useRef} from 'react'\nimport client from '../../feathers'\nimport {DebounceInput} from 'react-debounce-input';\nimport { useForm } from \"react-hook-form\";\n//import {DocumentClassList} from './DocumentClass'\n//import {useHistory} from 'react-router-dom'\nimport {UserContext,ObjectContext} from '../../context'\nimport {toast} from 'bulma-toast'\nimport {format, formatDistanceToNowStrict } from 'date-fns'\nimport  VideoConference  from '../utils/VideoConference';\n/* import  Prescription, { PrescriptionCreate } from './Prescription'; */\n\nexport default function DispensaryMain() {\n // const { register, handleSubmit, watch, errors } = useForm();\n    // eslint-disable-next-line\n    const [error, setError] =useState(false)\n     // eslint-disable-next-line\n    const [success, setSuccess] =useState(false)\n     // eslint-disable-next-line\n   const [message, setMessage] = useState(\"\") \n    const ClinicServ=client.service('clinicaldocument')\n    //const history = useHistory()\n   // const {user,setUser} = useContext(UserContext)\n    const [facilities,setFacilities]=useState([])\n     // eslint-disable-next-line\n   const [selectedClinic, setSelectedClinic]=useState() //\n    // eslint-disable-next-line\n    const {state,setState}=useContext(ObjectContext)\n    // eslint-disable-next-line\n    const {user,setUser}=useContext(UserContext)\n    const [showModal,setShowModal]=useState(false)\n    const [showPrescriptionModal,setShowPrescriptionModal]=useState(false)\n    // tracking on which page we currently are\n    const [page, setPage] = useState(0);\n    // add loader refrence \n    const loader = useRef(null);\n    \n    const standalone=false\n\n    const handleNewDocument= async()=>{\n        await setShowModal(true)                                                                                                                                                        \n        console.log( showModal)\n    }\n    const handleNewPrescription= async()=>{\n        await setShowPrescriptionModal(true)                                                                                                                                                        \n        console.log( showPrescriptionModal)\n    }\n\n\n    const handleCreateNew = async()=>{\n        const    newClinicModule={\n            selectedClinic:{},\n            show :'create'\n            }\n       await setState((prevstate)=>({...prevstate, ClinicModule:newClinicModule}))\n       //console.log(state)\n        \n\n    }\n    const handleRow= async(Clinic)=>{\n        //console.log(\"b4\",state)\n\n        //console.log(\"handlerow\",Clinic)\n\n        await setSelectedClinic(Clinic)\n\n        const    newClinicModule={\n            selectedClinic:Clinic,\n            show :'detail'\n        }\n       await setState((prevstate)=>({...prevstate, ClinicModule:newClinicModule}))\n       //console.log(state)\n       Clinic.show=!Clinic.show\n\n    }\n\n   const handleSearch=(val)=>{\n       const field='documentname'\n       console.log(val)\n       ClinicServ.find({query: {\n                [field]: {\n                    $regex:val,\n                    $options:'i'\n                   \n                },\n              // facility:user.currentEmployee.facilityDetail._id || \"\",\n               // locationType:\"Clinic\",\n               client:state.ClientModule.selectedClient._id,\n               $limit:10,\n                $sort: {\n                    name: 1\n                  }\n                    }}).then((res)=>{\n                console.log(res)\n               setFacilities(res.data)\n                setMessage(\" Clinic  fetched successfully\")\n                setSuccess(true) \n            })\n            .catch((err)=>{\n                console.log(err)\n                setMessage(\"Error fetching Clinic, probable network issues \"+ err )\n                setError(true)\n            })\n        }\n   \n    const getFacilities= async(page=0)=>{\n            /* const limit=20\n            alert(page) */\n            if (user.currentEmployee){\n            \n        const findClinic= await ClinicServ.find(\n                {query: {\n                    //locationType:\"Clinic\",\n                    //facility:user.currentEmployee.facilityDetail._id,\n                    client:state.ClientModule.selectedClient._id,\n                    $limit:20,\n                   /*  $skip:page*limit, */\n                    $sort: {\n                        createdAt: -1\n                    }\n                    }})\n            const total= findClinic.total\n            const ulimit=total*page\n           /*  if (total>(ulimit)){ //only load if we have not reached the total\n                alert(\"skip:\",ulimit )\n                console.log(\"skip:\",ulimit ) */\n            await setFacilities(findClinic.data)\n            console.log(findClinic.data)\n           /*  } */\n                }\n                else {\n                    if (user.stacker){\n                        const findClinic= await ClinicServ.find(\n                            {query: {\n                                client:state.ClientModule.selectedClient._id,\n                                    $limit:20,\n                                    $sort: {\n                                        createdAt: -1\n                                    }\n                                }})\n            \n                    await setFacilities(findClinic.data)\n\n                    }\n                }\n          /*   .then((res)=>{\n                console.log(res)\n                    setFacilities(res.data)\n                    setMessage(\" Clinic  fetched successfully\")\n                    setSuccess(true)\n                })\n                .catch((err)=>{\n                    setMessage(\"Error creating Clinic, probable network issues \"+ err )\n                    setError(true)\n                }) */\n            }\n          \n\n            useEffect(() => {\n                getFacilities()\n                if (user){\n                    \n                }else{\n                    /* const localUser= localStorage.getItem(\"user\")\n                    const user1=JSON.parse(localUser)\n                    console.log(localUser)\n                    console.log(user1)\n                    fetchUser(user1)\n                    console.log(user)\n                    getFacilities(user) */\n                }\n                ClinicServ.on('created', (obj)=>getFacilities(page))\n                ClinicServ.on('updated', (obj)=>getFacilities(page))\n                ClinicServ.on('patched', (obj)=>getFacilities(page))\n                ClinicServ.on('removed', (obj)=>getFacilities(page))\n\n                /* var options = {\n                    root: null,\n                    rootMargin: \"20px\",\n                    threshold: 1.0\n                 }; */\n                // initialize IntersectionObserver\n                // and attaching to Load More div\n                /*  const observer = new IntersectionObserver(handleObserver, options);\n                 if (loader.current) {\n                    observer.observe(loader.current)\n                 } */\n                return () => {\n                \n                }\n            },[])\n           /*  useEffect(() => {\n                // here we simulate adding new posts to List\n                getFacilities()\n            }, [page]) */\n\n             // here we handle what happens when user scrolls to Load More div\n            // in this case we just update page variable\n                /* const handleObserver = (entities) => {\n                    const target = entities[0];\n                    if (target.isIntersecting) {   \n                        setPage((page) => page + 1) //load more \n                        \n                    }\n                } */\n\n    return (\n        <div>\n            <VideoConference/>\n            <div className=\"level\">\n                    <div className=\"level-left\">\n                        <div className=\"level-item\">\n                            <div className=\"field\">\n                                <p className=\"control has-icons-left  \">\n                                    <DebounceInput className=\"input is-small \" \n                                        type=\"text\" placeholder=\"Search documentation\"\n                                        minLength={3}\n                                        debounceTimeout={400}\n                                        onChange={(e)=>handleSearch(e.target.value)} />\n                                    <span className=\"icon is-small is-left\">\n                                        <i className=\"fas fa-search\"></i>\n                                    </span>\n                                </p>\n                            </div>\n                        </div>\n                    </div>\n                   {/*  <div className=\"level-item\"> <span className=\"is-size-6 has-text-weight-medium\">List of Clinics</span></div> */}\n                    <div className=\"level-right\">\n                { !standalone &&   <div className=\"level-item\"> \n                            <div className=\"level-item\">\n                            <div className=\"button is-danger is-small mr-2\" onClick={handleNewPrescription}>Presciption</div>\n                                <div className=\"button is-success is-small\" onClick={handleNewDocument}>New Document</div>\n                                </div>\n                        </div>}\n                    </div>\n\n                </div>\n                \n                <div className=\" pullup \">\n                                <div className=\" is-fullwidth vscrollable pr-1\">\n                                   \n                                        {facilities.map((Clinic, i)=>(\n\n                                            <div key={Clinic._id}  onClick={()=>handleRow(Clinic)}   className={Clinic._id===(selectedClinic?._id||null)?\"is-selected\":\"\"}>\n                                               <div className=\"card mt-1 hovercard\">\n                                                    <header className=\"card-header\" onClick={(Clinic)=>Clinic.show=!Clinic.show}>\n                                                        <div className=\"card-header-title\">\n                                                        <div className=\"docdate\">{formatDistanceToNowStrict(new Date(Clinic.createdAt),{addSuffix: true})} <br/><span>{format(new Date(Clinic.createdAt),'dd-MM-yy')}</span></div> {Clinic.documentname} by {Clinic.createdByname} at {Clinic.location},{Clinic.facilityname} \n                                                        <p className=\"right ml-2 mr-0\">{Clinic.status} </p> \n                                                        </div>\n                                                       {/*  <button className=\"card-header-icon\" aria-label=\"more options\">\n                                                        <span className=\"icon\">\n                                                            <i className=\"fas fa-angle-down\" aria-hidden=\"true\"></i>\n                                                        </span>\n                                                        </button> */}\n                                                    </header>\n                                                  {Clinic.documentname!==\"Prescription\" &&  <div className={Clinic.show?\"card-content p-1\":\"card-content p-1 is-hidden\"}>\n                                                        { Object.entries(Clinic.documentdetail).map(([keys,value],i)=>(\n                                                            <div className=\"field is-horizontal\"> \n                                                                    <div className=\"field-label\"> \n                                                                        <label className=\"label is-size-7\" key={i}>\n                                                                            {keys}:\n                                                                            </label>\n                                                                    </div>\n                                                                    <div className=\"field-body\"> \n                                                                        <div className=\"field\" >\n                                                                            {value}   \n                                                                        </div>  \n                                                                    </div>                                                 \n                                                            </div>\n                                                            ))\n                                                        }\n                                                </div>}\n                                                {Clinic.documentname===\"Prescription\" &&  \n                                                <div className={Clinic.show?\"card-content p-1\":\"card-content p-1 is-hidden\"}>\n                                                        \n                                                        {(Clinic.documentdetail.length>0) && <div>\n                                                            <label>Medications:</label>\n                                                        <table className=\"table is-striped  is-hoverable is-fullwidth is-scrollable mr-2\">\n                                                                <thead>\n                                                                    <tr>\n                                                                    <th><abbr title=\"Serial No\">S/No</abbr></th>\n                                                                \n                                                                    <th><abbr title=\"Type\">Medication</abbr></th>\n                                                                    <th><abbr title=\"Destination\">Destination</abbr></th>\n                                                                    </tr>\n                                                                </thead>\n                                                                <tfoot>\n                                                                    \n                                                                </tfoot>\n                                                                <tbody>\n                                                                { Clinic.documentdetail.map((ProductEntry, i)=>(\n\n                                                                        <tr key={i}>\n                                                                        <th>{i+1}</th>\n                                                                        {/* <td>{ProductEntry.name}</td> */}\n                                                                        <td>{ProductEntry.medication}<br/>\n                                                                        <span className=\"help is-size-7\">{ProductEntry.instruction}</span></td> \n                                                                        <td>{ProductEntry.destination}</td>                                                                     \n                                                                        </tr>\n\n                                                                    ))}\n                                                                </tbody>\n                                                                </table>\n                                                                </div>}                                                   \n                                                            </div>}\n                                                    </div>                                           \n                                            </div>\n\n                                        ))}\n                                      {/* <!-- Add Ref to Load More div --> */}\n                                       {/*  <div className=\"loading\" ref={loader}>\n                                                <h2>Load More</h2>\n                                    </div> */}\n                                </div>\n                                    \n                </div> \n                <div className={`modal  ${showModal?\"is-active\":\"\"}` }>\n                                    <div className=\"modal-background\"></div>\n                                    <div className=\"modal-card \">\n                                        <header className=\"modal-card-head\">\n                                        <p className=\"modal-card-title\">Choose Document Class</p>\n                                        <button className=\"delete\" aria-label=\"close\"  onClick={()=>setShowModal(false)}></button>\n                                        </header>\n                                        <section className=\"modal-card-body\">\n                                        <DocumentClassList standalone=\"true\" />\n                                        </section>\n                                        {/* <footer className=\"modal-card-foot\">\n                                        <button className=\"button is-success\">Save changes</button>\n                                        <button className=\"button\">Cancel</button>\n                                        </footer> */}\n                                    </div>\n                                </div>\n                                <div className={`modal ${showPrescriptionModal?\"is-active\":\"\"}` }>\n                                    <div className=\"modal-background\"></div>\n                                    <div className=\"modal-card larger\">\n                                        <header className=\"modal-card-head\">\n                                        <p className=\"modal-card-title\">Prescription</p>\n                                        <button className=\"delete\" aria-label=\"close\"  onClick={()=>setShowPrescriptionModal(false)}></button>\n                                        </header>\n                                        <section className=\"modal-card-body\">\n                                        <Prescription standalone=\"true\" />\n                                        </section>\n                                        {/* <footer className=\"modal-card-foot\">\n                                        <button className=\"button is-success\">Save changes</button>\n                                        <button className=\"button\">Cancel</button>\n                                        </footer> */}\n                                    </div>\n                                </div>                            \n        </div>\n    )\n}\n"]},"metadata":{},"sourceType":"module"}