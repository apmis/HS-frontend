{"ast":null,"code":"import _defineProperty from\"/home/mfybaby/Documents/HealthStack2/HS-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _objectSpread from\"/home/mfybaby/Documents/HealthStack2/HS-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/home/mfybaby/Documents/HealthStack2/HS-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/mfybaby/Documents/HealthStack2/HS-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/mfybaby/Documents/HealthStack2/HS-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";/* eslint-disable */import React,{useState,useContext,useEffect,useRef}from'react';import client from'../../feathers';import{DebounceInput}from'react-debounce-input';import{useForm}from\"react-hook-form\";//import {useHistory} from 'react-router-dom'\nimport{UserContext,ObjectContext}from'../../context';import{toast}from'bulma-toast';//import {ProductCreate} from './Products'\nimport Encounter from'../EncounterMgt/Encounter';import ServiceSearch from'../helpers/ServiceSearch';var random=require('random-string-generator');// eslint-disable-next-line\nvar searchfacility={};export default function DischargeCreate(){// const { register, handleSubmit,setValue} = useForm(); //, watch, errors, reset \n//const [error, setError] =useState(false)\nvar _useState=useState(false),_useState2=_slicedToArray(_useState,2),success=_useState2[0],setSuccess=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),message=_useState4[0],setMessage=_useState4[1];// eslint-disable-next-line\nvar _useState5=useState(),_useState6=_slicedToArray(_useState5,2),facility=_useState6[0],setFacility=_useState6[1];var OrderServ=client.service('order');var ClientServ=client.service('clinicaldocument');var AdmissionServ=client.service('admission');//const history = useHistory()\nvar _useContext=useContext(UserContext),user=_useContext.user;//,setUser\n// eslint-disable-next-line\nvar _useState7=useState(),_useState8=_slicedToArray(_useState7,2),currentUser=_useState8[0],setCurrentUser=_useState8[1];var _useState9=useState(\"Bill\"),_useState10=_slicedToArray(_useState9,2),type=_useState10[0],setType=_useState10[1];var _useState11=useState(\"\"),_useState12=_slicedToArray(_useState11,2),documentNo=_useState12[0],setDocumentNo=_useState12[1];var _useState13=useState(0),_useState14=_slicedToArray(_useState13,2),totalamount=_useState14[0],setTotalamount=_useState14[1];var _useState15=useState(null),_useState16=_slicedToArray(_useState15,2),qamount=_useState16[0],setQAmount=_useState16[1];var _useState17=useState(\"\"),_useState18=_slicedToArray(_useState17,2),productId=_useState18[0],setProductId=_useState18[1];var _useState19=useState(\"\"),_useState20=_slicedToArray(_useState19,2),source=_useState20[0],setSource=_useState20[1];var _useState21=useState(\"\"),_useState22=_slicedToArray(_useState21,2),date=_useState22[0],setDate=_useState22[1];var _useState23=useState(\"\"),_useState24=_slicedToArray(_useState23,2),name=_useState24[0],setName=_useState24[1];var _useState25=useState(\"\"),_useState26=_slicedToArray(_useState25,2),inventoryId=_useState26[0],setInventoryId=_useState26[1];var _useState27=useState(\"\"),_useState28=_slicedToArray(_useState27,2),baseunit=_useState28[0],setBaseunit=_useState28[1];var _useState29=useState(1),_useState30=_slicedToArray(_useState29,2),quantity=_useState30[0],setQuantity=_useState30[1];var _useState31=useState(\"\"),_useState32=_slicedToArray(_useState31,2),sellingprice=_useState32[0],setSellingPrice=_useState32[1];var _useState33=useState(0),_useState34=_slicedToArray(_useState33,2),costprice=_useState34[0],setCostprice=_useState34[1];var _useState35=useState(\"\"),_useState36=_slicedToArray(_useState35,2),invquantity=_useState36[0],setInvQuantity=_useState36[1];var _useState37=useState(0),_useState38=_slicedToArray(_useState37,2),calcamount=_useState38[0],setCalcAmount=_useState38[1];var _useState39=useState([]),_useState40=_slicedToArray(_useState39,2),productItem=_useState40[0],setProductItem=_useState40[1];var _useState41=useState(\"\"),_useState42=_slicedToArray(_useState41,2),billingId=_useState42[0],setBilllingId=_useState42[1];var _useState43=useState(true),_useState44=_slicedToArray(_useState43,2),changeAmount=_useState44[0],setChangeAmount=_useState44[1];var _useState45=useState(\"\"),_useState46=_slicedToArray(_useState45,2),paymentmode=_useState46[0],setPaymentMode=_useState46[1];var _useState47=useState([]),_useState48=_slicedToArray(_useState47,2),paymentOptions=_useState48[0],setPaymentOptions=_useState48[1];var _useState49=useState(\"\"),_useState50=_slicedToArray(_useState49,2),billMode=_useState50[0],setBillMode=_useState50[1];var _useState51=useState(false),_useState52=_slicedToArray(_useState51,2),productModal=_useState52[0],setProductModal=_useState52[1];var _useState53=useState(\"\"),_useState54=_slicedToArray(_useState53,2),obj=_useState54[0],setObj=_useState54[1];var _useState55=useState(\"\"),_useState56=_slicedToArray(_useState55,2),objService=_useState56[0],setObjService=_useState56[1];var _useState57=useState(\"\"),_useState58=_slicedToArray(_useState57,2),patient=_useState58[0],setPatient=_useState58[1];var _useState59=useState(\"\"),_useState60=_slicedToArray(_useState59,2),contracts=_useState60[0],setContracts=_useState60[1];var _useState61=useState(\"\"),_useState62=_slicedToArray(_useState61,2),category=_useState62[0],setCategory=_useState62[1];var _useState63=useState(),_useState64=_slicedToArray(_useState63,2),chosenBed=_useState64[0],setChosenBed=_useState64[1];var _useState65=useState(),_useState66=_slicedToArray(_useState65,2),bedObject=_useState66[0],setBedObject=_useState66[1];var _useContext2=useContext(ObjectContext),state=_useContext2.state,setState=_useContext2.setState;var inputEl=useRef(0);var calcamount1;var hidestatus;var medication=state.DischargeModule.selectedDischarge;/*  let physicalbeds=state.WardModule.selectedWard?.sublocations\n   console.log(medication) */var showDocumentation=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(value){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setProductModal(true);case 1:case\"end\":return _context.stop();}}},_callee);}));return function showDocumentation(_x){return _ref.apply(this,arguments);};}();var handlecloseModal=function handlecloseModal(){setProductModal(false);// handleSearch(val)\n};var handleChangeMode=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(value){var billm;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return setPaymentMode(value);case 2:// console.log(paymentOptions)\nbillm=paymentOptions.filter(function(el){return el.name===value;});_context2.next=5;return setBillMode(billm[0]);case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function handleChangeMode(_x2){return _ref2.apply(this,arguments);};}();var handleRow=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(ProductEntry){var newProductEntryModule;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0://console.log(\"b4\",state)\n//console.log(\"handlerow\",ProductEntry)\n//await setMedication(ProductEntry)\nnewProductEntryModule={selectedMedication:ProductEntry,show:'detail'};_context3.next=3;return setState(function(prevstate){return _objectSpread(_objectSpread({},prevstate),{},{medicationModule:newProductEntryModule});});case 3:case\"end\":return _context3.stop();}}},_callee3);}));return function handleRow(_x3){return _ref3.apply(this,arguments);};}();var _useState67=useState({productitems:[],date:date,documentNo:documentNo,type:type,totalamount:totalamount,source:source}),_useState68=_slicedToArray(_useState67,2),productEntry=_useState68[0],setProductEntry=_useState68[1];var productItemI={productId:productId,name:name,quantity:quantity,sellingprice:sellingprice,amount:calcamount,//||qamount\nbaseunit:baseunit,costprice:costprice,category:\"Prescription\",//category===\"Inventory\"?\"Prescription\":category,\nbillingId:billingId,billMode:billMode};var checkPrice=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(contracts,billMode){var contract,_contract,_contract2,_contract3;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(!(billMode.type===\"HMO Cover\")){_context4.next=22;break;}if(!(billMode.detail.plan===\"NHIS\")){_context4.next=13;break;}//find contract for NHIS\ncontract=contracts.filter(function(el){return el.source_org_name===\"NHIS\";});if(!contract.length){_context4.next=8;break;}_context4.next=6;return setSellingPrice(contract[0].price);case 6:_context4.next=11;break;case 8:toast({message:'Please NHIS does not have cover/price for this service. Either set service price for NHIS, try another service or bill using cash',type:'is-danger',dismissible:true,pauseOnHover:true});_context4.next=11;return setSellingPrice(0);case 11:_context4.next=22;break;case 13:_contract=contracts.filter(function(el){return el.source_org===billMode.detail.organizationId;});if(!_contract.length){_context4.next=19;break;}_context4.next=17;return setSellingPrice(_contract[0].price);case 17:_context4.next=22;break;case 19:toast({message:'Please HMO does not have cover/price for this service. Either set service price for HMO , try another drug, bill using cash or adjust amount ',type:'is-danger',dismissible:true,pauseOnHover:true});_context4.next=22;return setSellingPrice(0);case 22:if(!(billMode.type===\"Company Cover\")){_context4.next=32;break;}//paymentmode\n_contract2=contracts.filter(function(el){return el.source_org===billMode.detail.organizationId;});if(!_contract2.length){_context4.next=29;break;}_context4.next=27;return setSellingPrice(_contract2[0].price);case 27:_context4.next=32;break;case 29:toast({message:'Please company does not have cover/price for this service. Either set service price for Company or try another drug or bill using cash',type:'is-danger',dismissible:true,pauseOnHover:true});_context4.next=32;return setSellingPrice(0);case 32:if(!(billMode.type===\"Cash\"||billMode.type===\"Family Cover\")){_context4.next=42;break;}//paymentmode\n_contract3=contracts.filter(function(el){return el.source_org===el.dest_org;});if(!_contract3.length){_context4.next=39;break;}_context4.next=37;return setSellingPrice(_contract3[0].price);case 37:_context4.next=42;break;case 39:toast({message:'Please there is no cover/price for this service. Either set service price or try another service. Setting price at zero ',type:'is-danger',dismissible:true,pauseOnHover:true});_context4.next=42;return setSellingPrice(0);case 42:case\"end\":return _context4.stop();}}},_callee4);}));return function checkPrice(_x4,_x5){return _ref4.apply(this,arguments);};}();// consider batchformat{batchno,expirydate,qtty,baseunit}\n//consider baseunoit conversions\nvar getSearchfacility=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(service){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:if(service){_context5.next=14;break;}//\"clear stuff\"\nsetProductId(\"\");setName(\"\");setBaseunit(\"\");setInventoryId(\"\");setSellingPrice(0);setInvQuantity(\"\");setQAmount(null);setCostprice(\"\");setContracts(\"\");setCategory(\"\");setInventoryId(\"\");setBilllingId(\"\");// setCalcAmount(null)\nreturn _context5.abrupt(\"return\");case 14:setContracts(service.contracts);setProductId(service.productId);setName(service.name);setCategory(service.category);//Lab Order\nsetBaseunit(service.baseunit);setInventoryId(service.inventoryId);setBilllingId(service._id);_context5.next=23;return setObj(service);case 23:case\"end\":return _context5.stop();}}},_callee5);}));return function getSearchfacility(_x6){return _ref5.apply(this,arguments);};}();useEffect(function(){},[obj]);useEffect(function(){setCurrentUser(user);//console.log(currentUser)\nreturn function(){};},[user]);var handleUpdateTotal=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.next=2;return setTotalamount(function(prevtotal){return Number(prevtotal)+Number(calcamount);});case 2:case\"end\":return _context6.stop();}}},_callee6);}));return function handleUpdateTotal(){return _ref6.apply(this,arguments);};}();var handleChangeType=/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(e){return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.next=2;return setType(e.target.value);case 2:case\"end\":return _context7.stop();}}},_callee7);}));return function handleChangeType(_x7){return _ref7.apply(this,arguments);};}();var handleAmount=/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(){return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_context8.next=2;return setQAmount(null);case 2:case\"end\":return _context8.stop();}}},_callee8);}));return function handleAmount(){return _ref8.apply(this,arguments);};}();var handleClickProd=/*#__PURE__*/function(){var _ref9=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(){var billInfo;return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:if(!(quantity===0||quantity===\"\"||productId===\"\"||paymentmode===\"\")){_context9.next=3;break;}toast({message:'You need to choose a product and quantity to proceed',type:'is-danger',dismissible:true,pauseOnHover:true});return _context9.abrupt(\"return\");case 3:_context9.next=5;return setSuccess(false);case 5:_context9.next=7;return setProductItem(function(prevProd){return prevProd.concat(productItemI);});case 7:handleUpdateTotal();// generate billing info\nbillInfo={orderInfo:{orderId:medication._id,orderObj:medication},serviceInfo:{price:productItemI.sellingprice,quantity:productItemI.quantity,productId:productItemI.productId,name:productItemI.name,baseunit:productItemI.baseunit,amount:productItemI.amount,billingId:productItemI.billingId,createdby:user._id},paymentInfo:{amountDue:productItemI.amount,paidup:0,balance:productItemI.amount,paymentDetails:[]},participantInfo:{billingFacility:medication.destination,billingFacilityName:medication.destination_name,locationId:state.StoreModule.selectedStore._id,//selected location,\nclientId:medication.clientId,client:medication.client,paymentmode:billMode},createdBy:user.id,billing_status:\"Unpaid\"};//update order\nOrderServ.patch(medication._id,{order_status:\"Billed\",//Billed\nbillInfo:billInfo}).then(function(resp){// medication=resp\n// console.log(resp)\nhandleRow(resp);//update dispense\n}).catch(function(err){console.log(err);});//update status(billed) + action()\n//?attached chosen product to medication\n//dispense helper?\nsetName(\"\");setBaseunit(\"\");setQuantity(\"\");setInventoryId(\"\");setSellingPrice(\"\");setInvQuantity(\"\");handleAmount();// setCalcAmount(null)\n_context9.next=19;return setSuccess(true);case 19:getSearchfacility(false);setObj(\"\");/* console.log(success)\n        console.log(qamount)\n        console.log(productItem) */setChangeAmount(true);case 22:case\"end\":return _context9.stop();}}},_callee9);}));return function handleClickProd(){return _ref9.apply(this,arguments);};}();var handleQtty=/*#__PURE__*/function(){var _ref10=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee10(e){return _regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:/*  if (invquantity<e.target.value){\n             toast({\n                 message: 'You can not sell more quantity than exist in inventory ' ,\n                 type: 'is-danger',\n                 dismissible: true,\n                 pauseOnHover: true,\n               })\n             return\n         } */setQuantity(e.target.value);if(e.target.vlue===\"\"){setQuantity(1);}/*  calcamount1=quantity*sellingprice\n         await setCalcAmount(calcamount1) */ //console.log(calcamount)\ncase 2:case\"end\":return _context10.stop();}}},_callee10);}));return function handleQtty(_x8){return _ref10.apply(this,arguments);};}();useEffect(function(){setProductEntry({date:date,documentNo:documentNo,type:type,totalamount:totalamount,source:source});setCalcAmount(quantity*sellingprice);return function(){};},[date]);var resetform=function resetform(){setType(\"Sales\");setDocumentNo(\"\");setTotalamount(\"\");setProductId(\"\");setSource(\"\");setDate(\"\");setName(\"\");setBaseunit();setCostprice();setProductItem([]);};var handleDischarge=/*#__PURE__*/function(){var _ref11=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee12(e){var note,document,admission;return _regeneratorRuntime.wrap(function _callee12$(_context12){while(1){switch(_context12.prev=_context12.next){case 0://handle admit\n//alert(\"something\")\n//update order\n//create admission resource\n//?create bill?\nnote={Note:\"Patient was discharged from \"+medication.client.ward+\" \"+state.employeeLocation.locationType+\", bed:\"+medication.client.bed+\" at \"+Date().toLocaleString(),Instruction:medication.instruction};//console.log(note)\ndocument={};// data.createdby=user._id\n// console.log(data);\nif(user.currentEmployee){document.facility=user.currentEmployee.facilityDetail._id;document.facilityname=user.currentEmployee.facilityDetail.facilityName;// or from facility dropdown\n}document.documentdetail=note;console.log(document.documentdetail);document.documentname=\"Discharge\";//state.DocumentClassModule.selectedDocumentClass.name\n// document.documentClassId=state.DocumentClassModule.selectedDocumentClass._id\ndocument.location=state.employeeLocation.locationName+\" \"+state.employeeLocation.locationType;document.locationId=state.employeeLocation.locationId;document.client=medication.client._id;document.clientname=medication.client.firstname+\" \"+medication.client.middlename+\" \"+medication.client.lastname;document.clientobj=medication.client;document.createdBy=user._id;document.createdByname=user.firstname+\" \"+user.lastname;document.status=\"completed\";admission={//  encounter_id:{type: Schema.Types.ObjectId,},\n//  hospitalization_id:{type: Schema.Types.ObjectId,},\n//order\norder:medication,order_id:medication._id,//location: ward/bed\nward_name:state.WardModule.selectedWard.typeName,ward_id:state.WardModule.selectedWard._id,bed:medication.client.bed,bed_id:medication.client.bed_id,facility:user.currentEmployee.facilityDetail._id,//billing:perpertuity\n/* bill:{type:Schema.Types.Mixed},\n                bill_id:{type: Schema.Types.ObjectId,}, */ //status\nstatus:\"free\",//client\nclient:medication.client,client_id:medication.clientId,//careteam\nadmissionhx:[],careteam:[],//start_time: new Date(),\nend_time:new Date(),createdby:user._id};document.admission=admission;console.log(document);e.preventDefault();setMessage(\"\");//  setError(false)\nsetSuccess(false);// data.createdby=user._id\n// console.log(data);\n/*   if (user.currentEmployee){\n                 data.facility=user.currentEmployee.facilityDetail._id  // or from facility dropdown\n                  } */ // data.locationType=\"Front Desk\"\nClientServ.create(document).then(/*#__PURE__*/function(){var _ref12=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee11(res){var newProductEntryModule;return _regeneratorRuntime.wrap(function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0://console.log(JSON.stringify(res))\n// e.target.reset();\n/*  setMessage(\"Created Clinic successfully\") */setSuccess(true);toast({message:'Discharge successfull',type:'is-success',dismissible:true,pauseOnHover:true});setSuccess(false);setChosenBed();setBedObject();newProductEntryModule={selectedDischarge:{},show:''};_context11.next=8;return setState(function(prevstate){return _objectSpread(_objectSpread({},prevstate),{},{DischargeModule:newProductEntryModule});});case 8:medication=\"\";case 9:case\"end\":return _context11.stop();}}},_callee11);}));return function(_x10){return _ref12.apply(this,arguments);};}()).catch(function(err){toast({message:'Error creating Discharge '+err,type:'is-danger',dismissible:true,pauseOnHover:true});});case 21:case\"end\":return _context12.stop();}}},_callee12);}));return function handleDischarge(_x9){return _ref11.apply(this,arguments);};}();var handleBed=function handleBed(e){//console.log(JSON.parse(e.target.value))\nsetChosenBed(e.target.value);var simpa=physicalbeds.find(function(obj){return obj._id===e.target.value;});setBedObject(simpa);};var onSubmit=/*#__PURE__*/function(){var _ref13=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee13(e){return _regeneratorRuntime.wrap(function _callee13$(_context13){while(1){switch(_context13.prev=_context13.next){case 0:e.preventDefault();setMessage(\"\");//setError(false)\nsetSuccess(false);_context13.next=5;return setProductEntry({date:date,documentNo:documentNo,type:type,totalamount:totalamount,source:source});case 5:productEntry.productitems=productItem;productEntry.createdby=user._id;productEntry.transactioncategory=\"debit\";if(!user.currentEmployee){_context13.next=12;break;}productEntry.facility=user.currentEmployee.facilityDetail._id;// or from facility dropdown\n_context13.next=14;break;case 12:toast({message:'You can not remove inventory from any organization',type:'is-danger',dismissible:true,pauseOnHover:true});return _context13.abrupt(\"return\");case 14:if(!state.StoreModule.selectedStore._id){_context13.next=18;break;}productEntry.storeId=state.StoreModule.selectedStore._id;_context13.next=20;break;case 18:toast({message:'You need to select a store before removing inventory',type:'is-danger',dismissible:true,pauseOnHover:true});return _context13.abrupt(\"return\");case 20:case\"end\":return _context13.stop();}}},_callee13);}));return function onSubmit(_x11){return _ref13.apply(this,arguments);};}();var handleChangeAmount=function handleChangeAmount(){setChangeAmount(function(rev){return!rev;});};var newclient=/*#__PURE__*/function(){var _ref14=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee14(){return _regeneratorRuntime.wrap(function _callee14$(_context14){while(1){switch(_context14.prev=_context14.next){case 0:_context14.next=2;return setProductItem([]);case 2:case\"end\":return _context14.stop();}}},_callee14);}));return function newclient(){return _ref14.apply(this,arguments);};}();useEffect(function(){setPatient(medication.client);var oldname=medication.clientname;// console.log(\"oldname\",oldname)\nsetSource(medication.clientname);var newname=source;// console.log(\"newname\",newname)\nif(oldname!==newname){//newclient\n//recalculate bedspace: subtract occupied from physical space\nsetProductItem([]);setTotalamount(0);}return function(){};},[medication]);useEffect(function(){//setPatient(medication.client)\nsetProductItem([]);setTotalamount(0);var paymentoptions=[];// const info = client.paymentinfo\nvar billme;var obj;patient&&patient.paymentinfo.forEach(function(pay,i){if(pay.active){switch(pay.paymentmode){case'Cash':// code block\nobj=createObj(pay,\"Cash\",\"Cash\",\"Cash\");paymentoptions.push(obj);setPaymentMode(\"Cash\");billme=obj;// console.log(\"billme\",billme)\nbreak;case'Family':// code block\nobj=createObj(pay,\"Family Cover\",\"familyCover\",\"Family Cover\");paymentoptions.push(obj);setPaymentMode(\"Family Cover\");billme=obj;// console.log(\"billme\",billme)\nbreak;case'Company':// code block\nvar _name=\"Company: \"+pay.organizationName+\"(\"+pay.plan+\")\";obj=createObj(pay,_name,\"CompanyCover\",\"Company Cover\");paymentoptions.push(obj);setPaymentMode(\"Company: \"+pay.organizationName+\"(\"+pay.plan+\")\");billme=obj;// console.log(\"billme\",billme)\nbreak;case'HMO':// code block\nvar sname=\"HMO: \"+pay.organizationName+\"(\"+pay.plan+\")\";obj=createObj(pay,sname,\"HMOCover\",\"HMO Cover\");paymentoptions.push(obj);setPaymentMode(\"HMO: \"+pay.organizationName+\"(\"+pay.plan+\")\");billme=obj;//  console.log(\"billme\",billme)\nbreak;default:// code block\n}}});setPaymentOptions(paymentoptions);setBillMode(billme);//console.log(paymentoptions)\n// console.log(billMode)\nreturn function(){};},[source]);//source\nvar findadmission=/*#__PURE__*/function(){var _ref15=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee15(){var admissiont;return _regeneratorRuntime.wrap(function _callee15$(_context15){while(1){switch(_context15.prev=_context15.next){case 0:_context15.next=2;return AdmissionServ.find({query:{order_id:medication._id}}).then(function(res){//  console.log(\"product  fetched successfully\") \n//  console.log(res.data) \nsetChosenBed(res.data);console.log(res.data);}).catch(function(err){toast({message:'Error creating ProductEntry '+err,type:'is-danger',dismissible:true,pauseOnHover:true});});case 2:admissiont=_context15.sent;console.log(admissiont);// setChosenBed(admissiont)\ncase 4:case\"end\":return _context15.stop();}}},_callee15);}));return function findadmission(){return _ref15.apply(this,arguments);};}();useEffect(function(){//get the admission info for the discharge order\nvar ward=state.WardModule.selectedWard;return function(){};},[]);useEffect(function(){// console.log(\"success\", success)\nif(success){setSuccess(false);}},[success]);var createObj=function createObj(pay,name,cover,type){var details={};details=_objectSpread({},pay);details.type=type;return{name:name,value:cover,detail:details,type:type};};useEffect(function(){//update selling price\nif(!!billMode&&!!contracts){// console.log(contracts)\ncheckPrice(contracts,billMode);}return function(){};},[obj]);useEffect(function(){calcamount1=quantity*sellingprice;setCalcAmount(calcamount1);// console.log(calcamount)\nsetChangeAmount(true);return function(){};},[quantity,sellingprice]);useEffect(function(){if(!!billMode&&!!contracts){checkPrice(contracts,billMode);}return function(){};},[billMode]);// console.log(\"simpa\")\nreturn/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"card card-overflow\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"card-header\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"card-header-title\",children:\"Discharge Patient\"}),/*#__PURE__*/_jsx(\"button\",{className:\"button is-success is-small btnheight mt-2\",onClick:showDocumentation,children:\"Documentation\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"card-content \",children:[/*#__PURE__*/_jsxs(\"form\",{onSubmit:onSubmit,children:[\" \",/*#__PURE__*/_jsx(\"div\",{className:\"field is-horizontal\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"field-body\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"field\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"control has-icons-left has-icons-right\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"input is-small\"/* ref={register({ required: true })} */,value:source,name:\"client\",type:\"text\",onChange:function onChange(e){return setSource(e.target.value);},placeholder:\"Client\"}),/*#__PURE__*/_jsx(\"span\",{className:\"icon is-small is-left\",children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-hospital\"})})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"field\",children:/*#__PURE__*/_jsx(\"div\",{className:\"control\",children:/*#__PURE__*/_jsx(\"div\",{className:\"select is-small \",children:/*#__PURE__*/_jsxs(\"select\",{name:\"paymentmode\",value:paymentmode,onChange:function onChange(e){return handleChangeMode(e.target.value);},className:\"selectadd\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Billing Mode \"}),paymentOptions.map(function(option,i){return/*#__PURE__*/_jsxs(\"option\",{value:option.details,children:[\" \",option.name]},i);})]})})})})]})})]}),/*#__PURE__*/_jsx(\"label\",{className:\"label is-small\",children:\"Discharge Order:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"field is-horizontal\",children:/*#__PURE__*/_jsx(\"div\",{className:\"field-body\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"field\",style:{width:\"40%\"},children:[/*#__PURE__*/_jsx(\"p\",{className:\"control has-icons-left\",children:/*#__PURE__*/_jsx(\"input\",{className:\"input is-small\"/* ref={register({ required: true })} */,disabled:true,name:\"order\",value:medication.order,type:\"text\",onChange:function onChange(e){return handleQtty(e);},placeholder:\"Quantity\"})}),/*#__PURE__*/_jsx(\"span\",{className:\"helper is-size-7\",children:/*#__PURE__*/_jsx(\"strong\",{children:\"Instructions: \"})}),/*#__PURE__*/_jsx(\"p\",{children:medication.instruction})]})})}),/*#__PURE__*/_jsxs(\"label\",{className:\"label is-small\",children:[\"Current Bed: \",medication.client.bed]}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"div\",{className:\"field mt-2 is-grouped\",children:/*#__PURE__*/_jsx(\"p\",{className:\"control\",children:/*#__PURE__*/_jsx(\"button\",{className:\"button is-success is-small\"/* disabled={!productItem.length>0} */,onClick:handleDischarge,children:\"Discharge\"})})})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal \".concat(productModal?\"is-active\":\"\"),children:[/*#__PURE__*/_jsx(\"div\",{className:\"modal-background\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-card  modalbkgrnd\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"modal-card-head  btnheight\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"modal-card-title\",children:\"Documentation\"}),/*#__PURE__*/_jsx(\"button\",{className:\"delete\",\"aria-label\":\"close\",onClick:handlecloseModal})]}),/*#__PURE__*/_jsx(\"section\",{className:\"modal-card-body modalcolor\",children:/*#__PURE__*/_jsx(Encounter,{standalone:\"true\"})})]})]})]});}export function InventorySearch(_ref16){var getSearchfacility=_ref16.getSearchfacility,clear=_ref16.clear;var productServ=client.service('inventory');var _useState69=useState([]),_useState70=_slicedToArray(_useState69,2),facilities=_useState70[0],setFacilities=_useState70[1];// eslint-disable-next-line\nvar _useState71=useState(false),_useState72=_slicedToArray(_useState71,2),searchError=_useState72[0],setSearchError=_useState72[1];// eslint-disable-next-line\nvar _useState73=useState(false),_useState74=_slicedToArray(_useState73,2),showPanel=_useState74[0],setShowPanel=_useState74[1];// eslint-disable-next-line\nvar _useState75=useState(\"\"),_useState76=_slicedToArray(_useState75,2),searchMessage=_useState76[0],setSearchMessage=_useState76[1];// eslint-disable-next-line \nvar _useState77=useState(\"\"),_useState78=_slicedToArray(_useState77,2),simpa=_useState78[0],setSimpa=_useState78[1];// eslint-disable-next-line \nvar _useState79=useState(false),_useState80=_slicedToArray(_useState79,2),chosen=_useState80[0],setChosen=_useState80[1];// eslint-disable-next-line \nvar _useState81=useState(0),_useState82=_slicedToArray(_useState81,2),count=_useState82[0],setCount=_useState82[1];var inputEl=useRef(null);var _useState83=useState(\"\"),_useState84=_slicedToArray(_useState83,2),val=_useState84[0],setVal=_useState84[1];var _useContext3=useContext(UserContext),user=_useContext3.user;var _useContext4=useContext(ObjectContext),state=_useContext4.state;var _useState85=useState(false),_useState86=_slicedToArray(_useState85,2),productModal=_useState86[0],setProductModal=_useState86[1];var handleRow=/*#__PURE__*/function(){var _ref17=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee16(obj){return _regeneratorRuntime.wrap(function _callee16$(_context16){while(1){switch(_context16.prev=_context16.next){case 0:_context16.next=2;return setChosen(true);case 2://alert(\"something is chaning\")\ngetSearchfacility(obj);_context16.next=5;return setSimpa(obj.name);case 5:// setSelectedFacility(obj)\nsetShowPanel(false);_context16.next=8;return setCount(2);case 8:case\"end\":return _context16.stop();}}},_callee16);}));return function handleRow(_x12){return _ref17.apply(this,arguments);};}();var handleBlur=/*#__PURE__*/function(){var _ref18=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee17(e){return _regeneratorRuntime.wrap(function _callee17$(_context17){while(1){switch(_context17.prev=_context17.next){case 0:case\"end\":return _context17.stop();}}},_callee17);}));return function handleBlur(_x13){return _ref18.apply(this,arguments);};}();var handleSearch=/*#__PURE__*/function(){var _ref19=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee18(value){var field,_query;return _regeneratorRuntime.wrap(function _callee18$(_context18){while(1){switch(_context18.prev=_context18.next){case 0:setVal(value);if(!(value===\"\")){_context18.next=5;break;}setShowPanel(false);getSearchfacility(false);return _context18.abrupt(\"return\");case 5:field='name';//field variable\nif(!(value.length>=3)){_context18.next=10;break;}productServ.find({query:(_query={},_defineProperty(_query,field,{$regex:value,$options:'i'}),_defineProperty(_query,\"facility\",user.currentEmployee.facilityDetail._id),_defineProperty(_query,\"storeId\",state.StoreModule.selectedStore._id),_defineProperty(_query,\"$limit\",10),_defineProperty(_query,\"$sort\",{createdAt:-1}),_query)}).then(function(res){//  console.log(\"product  fetched successfully\") \n//  console.log(res.data) \nsetFacilities(res.data);setSearchMessage(\" product  fetched successfully\");setShowPanel(true);}).catch(function(err){toast({message:'Error creating ProductEntry '+err,type:'is-danger',dismissible:true,pauseOnHover:true});});_context18.next=13;break;case 10:// console.log(\"less than 3 \")\n// console.log(val)\nsetShowPanel(false);_context18.next=13;return setFacilities([]);case 13:case\"end\":return _context18.stop();}}},_callee18);}));return function handleSearch(_x14){return _ref19.apply(this,arguments);};}();var handleAddproduct=function handleAddproduct(){setProductModal(true);};var handlecloseModal=function handlecloseModal(){setProductModal(false);handleSearch(val);};useEffect(function(){if(clear){//  console.log(\"success has changed\",clear)\nsetSimpa(\"\");}return function(){};},[clear]);return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"div\",{className:\"field\",children:/*#__PURE__*/_jsx(\"div\",{className:\"control has-icons-left  \",children:/*#__PURE__*/_jsxs(\"div\",{className:\"dropdown \".concat(showPanel?\"is-active\":\"\"),style:{width:\"100%\"},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"dropdown-trigger\",style:{width:\"100%\"},children:[/*#__PURE__*/_jsx(DebounceInput,{className:\"input is-small  is-expanded\",type:\"text\",placeholder:\"Search Product\",value:simpa,minLength:3,debounceTimeout:400,onBlur:function onBlur(e){return handleBlur(e);},onChange:function onChange(e){return handleSearch(e.target.value);},inputRef:inputEl}),/*#__PURE__*/_jsx(\"span\",{className:\"icon is-small is-left\",children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-search\"})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"dropdown-menu expanded\",style:{width:\"100%\"},children:/*#__PURE__*/_jsxs(\"div\",{className:\"dropdown-content\",children:[facilities.length>0?\"\":/*#__PURE__*/_jsxs(\"div\",{className:\"dropdown-item\"/* onClick={handleAddproduct} */,children:[\" \",/*#__PURE__*/_jsxs(\"span\",{children:[\" \",val,\" is not in your inventory\"]}),\" \"]}),facilities.map(function(facility,i){return/*#__PURE__*/_jsxs(\"div\",{className:\"dropdown-item\",onClick:function onClick(){return handleRow(facility);},children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"span\",{children:facility.name})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{children:/*#__PURE__*/_jsx(\"strong\",{children:facility.quantity})}),/*#__PURE__*/_jsxs(\"span\",{children:[facility.baseunit,\"(s) remaining\"]}),/*#__PURE__*/_jsxs(\"span\",{className:\"padleft\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Price:\"}),\" N\",facility.sellingprice]})]})]},facility._id);})]})})]})})})});}","map":{"version":3,"sources":["/home/mfybaby/Documents/HealthStack2/HS-frontend/src/components/Ward/DischargeCreate.js"],"names":["React","useState","useContext","useEffect","useRef","client","DebounceInput","useForm","UserContext","ObjectContext","toast","Encounter","ServiceSearch","random","require","searchfacility","DischargeCreate","success","setSuccess","message","setMessage","facility","setFacility","OrderServ","service","ClientServ","AdmissionServ","user","currentUser","setCurrentUser","type","setType","documentNo","setDocumentNo","totalamount","setTotalamount","qamount","setQAmount","productId","setProductId","source","setSource","date","setDate","name","setName","inventoryId","setInventoryId","baseunit","setBaseunit","quantity","setQuantity","sellingprice","setSellingPrice","costprice","setCostprice","invquantity","setInvQuantity","calcamount","setCalcAmount","productItem","setProductItem","billingId","setBilllingId","changeAmount","setChangeAmount","paymentmode","setPaymentMode","paymentOptions","setPaymentOptions","billMode","setBillMode","productModal","setProductModal","obj","setObj","objService","setObjService","patient","setPatient","contracts","setContracts","category","setCategory","chosenBed","setChosenBed","bedObject","setBedObject","state","setState","inputEl","calcamount1","hidestatus","medication","DischargeModule","selectedDischarge","showDocumentation","value","handlecloseModal","handleChangeMode","billm","filter","el","handleRow","ProductEntry","newProductEntryModule","selectedMedication","show","prevstate","medicationModule","productitems","productEntry","setProductEntry","productItemI","amount","checkPrice","detail","plan","contract","source_org_name","length","price","dismissible","pauseOnHover","source_org","organizationId","dest_org","getSearchfacility","_id","handleUpdateTotal","prevtotal","Number","handleChangeType","e","target","handleAmount","handleClickProd","prevProd","concat","billInfo","orderInfo","orderId","orderObj","serviceInfo","createdby","paymentInfo","amountDue","paidup","balance","paymentDetails","participantInfo","billingFacility","destination","billingFacilityName","destination_name","locationId","StoreModule","selectedStore","clientId","createdBy","id","billing_status","patch","order_status","then","resp","catch","err","console","log","handleQtty","vlue","resetform","handleDischarge","note","Note","ward","employeeLocation","locationType","bed","Date","toLocaleString","Instruction","instruction","document","currentEmployee","facilityDetail","facilityname","facilityName","documentdetail","documentname","location","locationName","clientname","firstname","middlename","lastname","clientobj","createdByname","status","admission","order","order_id","ward_name","WardModule","selectedWard","typeName","ward_id","bed_id","client_id","admissionhx","careteam","end_time","preventDefault","create","res","handleBed","simpa","physicalbeds","find","onSubmit","transactioncategory","storeId","handleChangeAmount","rev","newclient","oldname","newname","paymentoptions","billme","paymentinfo","forEach","pay","i","active","createObj","push","organizationName","sname","findadmission","query","data","admissiont","cover","details","map","option","width","InventorySearch","clear","productServ","facilities","setFacilities","searchError","setSearchError","showPanel","setShowPanel","searchMessage","setSearchMessage","setSimpa","chosen","setChosen","count","setCount","val","setVal","handleBlur","handleSearch","field","$regex","$options","createdAt","handleAddproduct"],"mappings":"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","sourcesContent":["/* eslint-disable */\nimport React, {useState,useContext, useEffect,useRef} from 'react'\nimport client from '../../feathers'\nimport {DebounceInput} from 'react-debounce-input';\nimport { useForm } from \"react-hook-form\";\n//import {useHistory} from 'react-router-dom'\nimport {UserContext,ObjectContext} from '../../context'\nimport {toast} from 'bulma-toast'\n//import {ProductCreate} from './Products'\nimport Encounter from '../EncounterMgt/Encounter';\nimport  ServiceSearch  from '../helpers/ServiceSearch';\nvar random = require('random-string-generator');\n// eslint-disable-next-line\nconst searchfacility={};\n\nexport default function DischargeCreate(){\n    // const { register, handleSubmit,setValue} = useForm(); //, watch, errors, reset \n     //const [error, setError] =useState(false)\n     const [success, setSuccess] =useState(false)\n     const [message,setMessage] = useState(\"\")\n     // eslint-disable-next-line\n     const [facility,setFacility] = useState()\n   \n     const OrderServ=client.service('order')\n     const ClientServ=client.service('clinicaldocument')\n     const AdmissionServ=client.service('admission')\n     //const history = useHistory()\n     const {user} = useContext(UserContext) //,setUser\n     // eslint-disable-next-line\n     const [currentUser,setCurrentUser] = useState()\n     const [type,setType] = useState(\"Bill\")\n     const [documentNo,setDocumentNo] = useState(\"\")\n     const [totalamount,setTotalamount] = useState(0)\n     const [qamount,setQAmount] = useState(null)\n     const [productId,setProductId] = useState(\"\")\n     const [source,setSource] = useState(\"\")\n     const [date,setDate] = useState(\"\")\n     const [name,setName] = useState(\"\")\n     const [inventoryId,setInventoryId] = useState(\"\")\n     const [baseunit,setBaseunit] = useState(\"\")\n     const [quantity,setQuantity] = useState(1)\n     const [sellingprice,setSellingPrice] = useState(\"\")\n     const [costprice,setCostprice] = useState(0)\n     const [invquantity,setInvQuantity] = useState(\"\")\n     const [calcamount,setCalcAmount] = useState(0)\n     const [productItem,setProductItem] = useState([])\n      const [billingId,setBilllingId]=useState(\"\")  \n      const [changeAmount, setChangeAmount] = useState(true)\n      const [paymentmode, setPaymentMode] = useState(\"\")\n      const [paymentOptions, setPaymentOptions]=useState([])\n      const [billMode, setBillMode]=useState(\"\")\n      const [productModal, setProductModal]=useState(false)\n      const [obj, setObj]=useState(\"\")\n      const [objService, setObjService]=useState(\"\")\n      const [patient, setPatient]=useState(\"\")\n      const [contracts, setContracts]=useState(\"\")\n      const [category, setCategory]=useState(\"\")\n      const [chosenBed, setChosenBed]=useState()\n      const [bedObject, setBedObject]=useState()\n\n     const {state,setState}=useContext(ObjectContext)\n     const inputEl = useRef(0);\n     let calcamount1\n     let hidestatus\n  \n\n    \n  let medication =state.DischargeModule.selectedDischarge\n /*  let physicalbeds=state.WardModule.selectedWard?.sublocations\n   console.log(medication) */\n\n  const showDocumentation = async (value)=>{\n    setProductModal(true)\n  }\n  const handlecloseModal =()=>{\n    setProductModal(false)\n   // handleSearch(val)\n    }\n\n\n    const handleChangeMode= async(value)=>{\n       // console.log(value)\n       await setPaymentMode(value)\n       // console.log(paymentOptions)\n       let billm= paymentOptions.filter(el=>el.name===value)\n       await setBillMode(billm[0])\n        //console.log(billm)\n        // at startup\n        // check payment mode options from patient financial info\n        // load that to select options\n        // default to HMO-->company-->family-->cash\n        //when chosen\n        //append payment mode to order\n        //check service contract for pricing info\n        // calculate pricing \n        // pricing\n\n\n    }\n\n    const handleRow= async(ProductEntry)=>{\n    //console.log(\"b4\",state)\n\n    //console.log(\"handlerow\",ProductEntry)\n\n    //await setMedication(ProductEntry)\n\n            const    newProductEntryModule={\n                selectedMedication:ProductEntry,\n                show :'detail'\n            }\n            await setState((prevstate)=>({...prevstate, medicationModule:newProductEntryModule}))\n   //console.log(state)\n  // ProductEntry.show=!ProductEntry.show\n\n        } \n \n     const [productEntry,setProductEntry]=useState({\n         productitems:[],\n         date,\n         documentNo,\n         type,\n         totalamount,\n         source,\n \n     })\n  \n     const productItemI={\n         productId,\n         name,\n         quantity,\n         sellingprice,\n         amount:calcamount, //||qamount\n         baseunit,\n         costprice,\n         category:\"Prescription\",  //category===\"Inventory\"?\"Prescription\":category,\n         billingId,\n         billMode\n \n     }\n\n     const checkPrice= async(contracts,billMode)=>{\n         \n\n        if( billMode.type===\"HMO Cover\"){ //paymentmode\n         if (billMode.detail.plan===\"NHIS\"){\n             //find contract for NHIS\n             let contract=contracts.filter(el=>el.source_org_name===\"NHIS\")\n             if (contract.length){\n                // console.log(contract[0].price)\n               await  setSellingPrice(contract[0].price)     \n          }else{\n             toast({\n                 message: 'Please NHIS does not have cover/price for this service. Either set service price for NHIS, try another service or bill using cash',\n                 type: 'is-danger',\n                 dismissible: true,\n                 pauseOnHover: true,\n               })\n              await setSellingPrice(0)\n          }\n\n         }else{\n\n         let contract=contracts.filter(el=>el.source_org===billMode.detail.organizationId)\n         if (contract.length){\n           // console.log(contract[0].price)\n            await setSellingPrice(contract[0].price)\n            \n          }else{\n         toast({\n             message: 'Please HMO does not have cover/price for this service. Either set service price for HMO , try another drug, bill using cash or adjust amount ',\n             type: 'is-danger',\n             dismissible: true,\n             pauseOnHover: true,\n           })\n           await setSellingPrice(0)\n      }\n     \n     }\n     }\n     if( billMode.type===\"Company Cover\"){ //paymentmode\n         let contract=contracts.filter(el=>el.source_org===billMode.detail.organizationId)\n         if (contract.length){\n        // console.log(contract[0].price)\n       await   setSellingPrice(contract[0].price)\n         \n        \n        }else{\n\n         toast({\n             message: 'Please company does not have cover/price for this service. Either set service price for Company or try another drug or bill using cash',\n             type: 'is-danger',\n             dismissible: true,\n             pauseOnHover: true,\n           })\n         await  setSellingPrice(0)   \n      }\n\n  }\n  if( billMode.type===\"Cash\" || billMode.type===\"Family Cover\"){ //paymentmode\n     let contract=contracts.filter(el=>el.source_org===el.dest_org)\n     if (contract.length){\n    // console.log(contract[0].price)\n     await setSellingPrice(contract[0].price)\n    \n    \n         }else{\n\n     toast({\n         message: 'Please there is no cover/price for this service. Either set service price or try another service. Setting price at zero ',\n         type: 'is-danger',\n         dismissible: true,\n         pauseOnHover: true,\n       })\n       await setSellingPrice(0)   \n  }\n\n  }\n\n    }\n     // consider batchformat{batchno,expirydate,qtty,baseunit}\n     //consider baseunoit conversions\n     const getSearchfacility=async (service)=>{\n        // console.log(obj)\n       \n        if (!service){\n            //\"clear stuff\"\n            setProductId(\"\")\n            setName(\"\")\n            setBaseunit(\"\")\n            setInventoryId(\"\")\n            setSellingPrice(0)\n            setInvQuantity(\"\")\n            setQAmount(null)\n            setCostprice(\"\")\n            setContracts(\"\")\n            setCategory(\"\")\n            setInventoryId(\"\")\n            setBilllingId(\"\")\n           // setCalcAmount(null)\n            return\n        }\n \n        setContracts(service.contracts)\n         setProductId(service.productId)\n         setName(service.name)\n         setCategory(service.category) //Lab Order\n         setBaseunit(service.baseunit)\n         setInventoryId(service.inventoryId)\n         setBilllingId(service._id)\n         await setObj(service)\n\n       \n    }\n     useEffect(() => {\n      \n     }, [obj])\n\n     useEffect(() => {\n         setCurrentUser(user)\n         //console.log(currentUser)\n         return () => {\n         \n         }\n     }, [user])\n \n     const handleUpdateTotal=async ()=>{\n        await setTotalamount(prevtotal=>Number(prevtotal) + Number(calcamount))\n     }\n \n     const handleChangeType=async (e)=>{\n         //console.log(e.target.value)\n         await setType(e.target.value)\n     }\n \n     const handleAmount= async()=>{\n         await setQAmount(null)\n        // alert(\"Iam chaning qamount\")\n     }\n\n     const handleClickProd=async()=>{\n       /*   console.log(\"amount: \",productItemI.amount)\n         console.log(\"qamount: \",qamount)\n         console.log(\"calcamount: \",calcamount) */\n        if ( quantity===0||quantity===\"\"|| productId===\"\"||paymentmode===\"\" ){\n            toast({\n                message: 'You need to choose a product and quantity to proceed',\n                type: 'is-danger',\n                dismissible: true,\n                pauseOnHover: true,\n              }) \n              return \n        }\n\n         await setSuccess(false)\n         await setProductItem(\n             prevProd=>prevProd.concat(productItemI)\n         )\n        handleUpdateTotal()\n            // generate billing info\n            const billInfo={\n                orderInfo:{\n                    orderId:medication._id,\n                    orderObj:medication,\n                  },\n                  serviceInfo:{            \n                    price: productItemI.sellingprice,\n                    quantity: productItemI.quantity,\n                    productId: productItemI.productId,\n                    name: productItemI.name,\n                    baseunit: productItemI.baseunit,\n                    amount:productItemI.amount,\n                    billingId:productItemI.billingId,\n                    createdby:user._id,\n                  },\n                  paymentInfo:{\n                    amountDue:productItemI.amount,\n                    paidup:0,\n                    balance:productItemI.amount,\n                    paymentDetails:[]\n              \n                  },\n                  participantInfo:{\n                    billingFacility:medication.destination,\n                    billingFacilityName:medication.destination_name,\n                    locationId:state.StoreModule.selectedStore._id, //selected location,\n                    clientId:medication.clientId,\n                    client:medication.client,\n                    paymentmode:billMode\n                  },\n                  createdBy:user.id,\n                  billing_status:\"Unpaid\"\n                }\n\n        //update order\n        \n        OrderServ.patch(medication._id,{\n            order_status:\"Billed\", //Billed\n            billInfo,\n        }).then((resp)=>{\n           // medication=resp\n           // console.log(resp)\n             handleRow(resp) \n            //update dispense\n\n        })\n        .catch((err)=>{\n            console.log(err)\n        })\n        \n        //update status(billed) + action()\n        //?attached chosen product to medication\n        //dispense helper?\n         setName(\"\")\n         setBaseunit(\"\")\n         setQuantity(\"\")\n         setInventoryId(\"\")\n         setSellingPrice(\"\")\n         setInvQuantity(\"\")\n             handleAmount()\n        // setCalcAmount(null)\n        await setSuccess(true)\n        getSearchfacility(false)\n        setObj(\"\")\n        /* console.log(success)\n        console.log(qamount)\n        console.log(productItem) */\n        setChangeAmount(true)\n       \n     }\n  \n \n     const handleQtty=async(e)=>{\n        /*  if (invquantity<e.target.value){\n             toast({\n                 message: 'You can not sell more quantity than exist in inventory ' ,\n                 type: 'is-danger',\n                 dismissible: true,\n                 pauseOnHover: true,\n               })\n             return\n         } */\n         setQuantity(e.target.value)\n         if (e.target.vlue===\"\"){\n            setQuantity(1)\n         }\n        /*  calcamount1=quantity*sellingprice\n         await setCalcAmount(calcamount1) */\n         //console.log(calcamount)\n     }\n \n     useEffect( () => {\n          setProductEntry({\n             \n             date,\n             documentNo,\n             type,\n             totalamount,\n             source,\n         })\n        setCalcAmount(quantity*sellingprice) \n         return () => {\n             \n         }\n     },[date])\n \n     const resetform=()=>{\n      setType(\"Sales\")\n     setDocumentNo(\"\")\n     setTotalamount(\"\")\n     setProductId(\"\")\n     setSource(\"\")\n     setDate(\"\")\n     setName(\"\")\n     setBaseunit()\n     setCostprice()\n     setProductItem([])\n     }\n\n\n     const handleDischarge= async(e)=>{ //handle admit\n\n    //alert(\"something\")\n    //update order\n    //create admission resource\n    //?create bill?\n\n    const note={\n       Note:\"Patient was discharged from \" + medication.client.ward + \" \" + state.employeeLocation.locationType + \", bed:\"+ medication.client.bed +\" at \" +  Date().toLocaleString(),\n       Instruction: medication.instruction\n    }\n\n    //console.log(note)\n    let document={}\n    // data.createdby=user._id\n    // console.log(data);\n        if (user.currentEmployee){\n        document.facility=user.currentEmployee.facilityDetail._id \n        document.facilityname=user.currentEmployee.facilityDetail.facilityName // or from facility dropdown\n        }\n        document.documentdetail=note\n        console.log(document.documentdetail)\n        document.documentname=\"Discharge\" //state.DocumentClassModule.selectedDocumentClass.name\n        // document.documentClassId=state.DocumentClassModule.selectedDocumentClass._id\n        document.location=state.employeeLocation.locationName+\" \"+state.employeeLocation.locationType\n        document.locationId=state.employeeLocation.locationId\n        document.client=medication.client._id\n        document.clientname=medication.client.firstname+ \" \"+ medication.client.middlename+\" \"+ medication.client.lastname\n        document.clientobj=medication.client\n        document.createdBy=user._id\n        document.createdByname=user.firstname+ \" \"+user.lastname\n        document.status=\"completed\"\n\n\n    const   admission={\n              //  encounter_id:{type: Schema.Types.ObjectId,},\n              //  hospitalization_id:{type: Schema.Types.ObjectId,},\n                //order\n                order:medication,\n                order_id:medication._id,\n\n                //location: ward/bed\n                ward_name:state.WardModule.selectedWard.typeName,\n                ward_id:state.WardModule.selectedWard._id,\n                bed:medication.client.bed,\n                bed_id:medication.client.bed_id,\n                facility:user.currentEmployee.facilityDetail._id,\n                //billing:perpertuity\n                /* bill:{type:Schema.Types.Mixed},\n                bill_id:{type: Schema.Types.ObjectId,}, */\n                //status\n                status:\"free\",\n                //client\n                client:medication.client,\n                client_id:medication.clientId,\n                //careteam\n                admissionhx:[],\n                careteam:[],\n                //start_time: new Date(),\n                end_time:new Date(),\n                createdby:user._id,\n              \n                }\n               document.admission=admission\n               console.log(document)\n                e.preventDefault();\n                setMessage(\"\")\n              //  setError(false)\n                setSuccess(false)\n                 // data.createdby=user._id\n                 // console.log(data);\n                /*   if (user.currentEmployee){\n                 data.facility=user.currentEmployee.facilityDetail._id  // or from facility dropdown\n                  } */\n                 // data.locationType=\"Front Desk\"\n                 ClientServ.create(document)\n                .then(async (res)=>{\n                        //console.log(JSON.stringify(res))\n                       // e.target.reset();\n                       /*  setMessage(\"Created Clinic successfully\") */\n                        setSuccess(true)\n                        toast({\n                            message: 'Discharge successfull',\n                            type: 'is-success',\n                            dismissible: true,\n                            pauseOnHover: true,\n                          })\n                          setSuccess(false)\n                          setChosenBed()                        \n                          setBedObject()\n                          const    newProductEntryModule={\n                            selectedDischarge:{},\n                            show :''\n                        }\n                      await setState((prevstate)=>({...prevstate, DischargeModule:newProductEntryModule}))\n                      medication=\"\"\n                    })\n                    .catch((err)=>{\n                        toast({\n                            message: 'Error creating Discharge ' + err,\n                            type: 'is-danger',\n                            dismissible: true,\n                            pauseOnHover: true,\n                          })\n                    }) \n    }\n \n\n    const handleBed=(e)=>{\n        //console.log(JSON.parse(e.target.value))\n       setChosenBed(e.target.value)\n        let simpa= physicalbeds.find(obj=>obj._id===e.target.value)\n        setBedObject(simpa)\n\n    }\n\n     const onSubmit = async(e) =>{\n         e.preventDefault();\n         setMessage(\"\")\n         //setError(false)\n         setSuccess(false)\n         await setProductEntry({\n             \n             date,\n             documentNo,\n             type,\n             totalamount,\n             source,\n         })\n         productEntry.productitems=productItem\n         productEntry.createdby=user._id\n         productEntry.transactioncategory=\"debit\"\n           if (user.currentEmployee){\n          productEntry.facility=user.currentEmployee.facilityDetail._id  // or from facility dropdown\n           }else{\n             toast({\n                 message: 'You can not remove inventory from any organization',\n                 type: 'is-danger',\n                 dismissible: true,\n                 pauseOnHover: true,\n               }) \n               return\n           }\n           \n           if (state.StoreModule.selectedStore._id){\n             productEntry.storeId=state.StoreModule.selectedStore._id\n           }else{\n             toast({\n                 message: 'You need to select a store before removing inventory',\n                 type: 'is-danger',\n                 dismissible: true,\n                 pauseOnHover: true,\n               }) \n               return\n           }\n           \n \n       } \n \n  \n    const handleChangeAmount=()=>{\n        setChangeAmount((rev)=>(!rev))\n        \n    }\n\n    const newclient=async ()=>{\n        await  setProductItem([])\n    }\n\n    useEffect(() => {\n        setPatient(medication.client)\n        const oldname=medication.clientname\n       // console.log(\"oldname\",oldname)\n        setSource(medication.clientname)\n\n        const newname=source\n       // console.log(\"newname\",newname)\n        if (oldname!==newname){\n            //newclient\n\n            //recalculate bedspace: subtract occupied from physical space\n\n        \n        setProductItem([])\n        setTotalamount(0)\n\n        }\n       \n\n\n        return () => {\n           \n        }\n    }, [medication])\n\n    useEffect(() => {\n        //setPatient(medication.client)\n        setProductItem([])\n        setTotalamount(0)\n        const paymentoptions= []\n       // const info = client.paymentinfo\n        let billme\n       let obj\n       patient &&  patient.paymentinfo.forEach((pay,i)=>{ \n           if (pay.active){\n       \n            switch(pay.paymentmode) {\n                case 'Cash':\n                  // code block\n                  obj=createObj(pay,\"Cash\",\"Cash\",\"Cash\" )\n                \n                  paymentoptions.push(obj)\n                  setPaymentMode(\"Cash\")\n                  billme=obj\n                 // console.log(\"billme\",billme)\n                  break;\n                case 'Family':\n                  // code block\n                  obj=createObj(pay,\"Family Cover\",\"familyCover\", \"Family Cover\")\n                  paymentoptions.push(obj)\n                  setPaymentMode(\"Family Cover\")\n                  billme=obj\n                 // console.log(\"billme\",billme)\n                  break;\n                case 'Company':\n                  // code block\n                  let name=\"Company: \" + pay.organizationName + \"(\" + pay.plan+\")\"\n\n                  obj=createObj(pay,name,\"CompanyCover\", \"Company Cover\" )\n                      paymentoptions.push(obj)\n                      setPaymentMode(\"Company: \" + pay.organizationName + \"(\" + pay.plan+\")\")\n                     billme=obj\n                    // console.log(\"billme\",billme)\n                  break;\n                case 'HMO':\n                  // code block\n                 let  sname=\"HMO: \" + pay.organizationName + \"(\" + pay.plan+\")\"\n\n                  obj=createObj(pay,sname,\"HMOCover\", \"HMO Cover\" )\n                      paymentoptions.push(obj)\n                      setPaymentMode(\"HMO: \" + pay.organizationName + \"(\" + pay.plan+\")\")\n                     billme=obj\n                   //  console.log(\"billme\",billme)\n                  break;\n                default:\n                  // code block\n              }\n            }\n            })\n                    \n          \n        setPaymentOptions(paymentoptions)\n        setBillMode(billme)\n       //console.log(paymentoptions)\n       // console.log(billMode)\n        return () => {\n           \n        }\n    }, [source]) //source\n\n    const findadmission= async()=>{\n\n        const admissiont= await AdmissionServ.find({\n            query:{\n                order_id: medication._id\n            }\n        }).then((res)=>{\n         //  console.log(\"product  fetched successfully\") \n         //  console.log(res.data) \n             setChosenBed(res.data)\n            \n             console.log(res.data)\n          })\n          .catch((err)=>{\n             toast({\n                 message: 'Error creating ProductEntry ' + err,\n                 type: 'is-danger',\n                 dismissible: true,\n                 pauseOnHover: true,\n               })\n          })\n          console.log(admissiont)\n         // setChosenBed(admissiont)\n    }\n\n     useEffect(() => {\n       //get the admission info for the discharge order\n       \n       \n         const ward= state.WardModule.selectedWard\n         return () => {\n             \n         }\n     }, [])\n\n     useEffect(() => {\n        // console.log(\"success\", success)\n         if (success){\n             setSuccess(false)\n         }\n       \n      }, [success])\n\n      const createObj= (pay,name,cover,type)=>{\n        let details={}\n          details= {...pay}\n          details.type=type\n  \n      return {\n              name,\n              value:cover,\n              detail:details,\n              type,\n          }\n  \n      }\n\n      useEffect(() => {\n        \n        //update selling price\n        if (!!billMode && !!contracts){\n           // console.log(contracts)\n            checkPrice(contracts,billMode)\n        }\n       \n        return () => {\n           \n        }\n    }, [obj])\n\n     useEffect(() => {\n        calcamount1=quantity*sellingprice\n         setCalcAmount(calcamount1)\n        // console.log(calcamount)\n         setChangeAmount(true)\n        return () => {\n            \n        }\n    }, [quantity,sellingprice])\n\n    useEffect(() => {\n       \n        if (!!billMode && !!contracts){\n            \n            checkPrice(contracts,billMode)\n        }\n        \n        return () => {\n            \n        }\n    }, [billMode])\n\n// console.log(\"simpa\")\n     return (\n         <>\n             <div className=\"card card-overflow\">\n             <div className=\"card-header\">\n                 <p className=\"card-header-title\">\n                    Discharge Patient\n                 </p>\n                 <button className=\"button is-success is-small btnheight mt-2\" onClick={showDocumentation}>Documentation</button>\n             </div>\n             <div className=\"card-content \">\n    \n             <form onSubmit={onSubmit}> {/* handleSubmit(onSubmit) */}\n             <div className=\"field is-horizontal\">\n             <div className=\"field-body\">\n            {/*  <div className=\"field\">    \n                 <div className=\"control\">\n                     <div className=\"select is-small\">\n                         <select name=\"type\" value={type} onChange={handleChangeType} className=\"selectadd\">\n                            <option value=\"\">Choose Type </option>\n                             <option value=\"Dispense\">Dispense</option>\n                             <option value=\"Bill\">Bill </option> */}\n                             {/* <option value=\"Dispense\">Dispense</option>\n                             <option value=\"Audit\">Audit</option> */}\n                 {/*         </select>\n                     </div>\n                 </div>\n             </div>\n */}\n             <div className=\"field\">\n                     <p className=\"control has-icons-left has-icons-right\">\n                         <input className=\"input is-small\" /* ref={register({ required: true })} */ value={source} name=\"client\" type=\"text\" onChange={e=>setSource(e.target.value)} placeholder=\"Client\" />\n                         <span className=\"icon is-small is-left\">\n                             <i className=\"fas fa-hospital\"></i>\n                         </span>                    \n                     </p>\n                 </div>\n                 <div className=\"field\">    \n                 <div className=\"control\">\n                     <div className=\"select is-small \">\n                         <select name=\"paymentmode\" value={paymentmode} onChange={(e)=>handleChangeMode(e.target.value)} className=\"selectadd\" >\n                         <option value=\"\">Billing Mode </option>\n                           {paymentOptions.map((option,i)=>(\n                               <option key={i} value={option.details}> {option.name}</option>\n                           ))}\n                           \n                            \n                            {/*  <option value=\"Cash\">Cash</option>\n                             <option value=\"Family\">Family </option>\n                            <option value=\"Company Cover\">Company Cover</option>\n                             <option value=\"HMO\">HMO</option> */}\n                         </select>\n                     </div>\n                 </div>\n             </div>\n            \n             </div>\n             </div> \n                \n                 </form>   \n                \n            \n          {/* array of ProductEntry items */}\n         \n         <label className=\"label is-small\">Discharge Order:</label>\n         <div className=\"field is-horizontal\">\n             <div className=\"field-body\">\n             <div className=\"field\" style={{width:\"40%\"}}>\n                 <p className=\"control has-icons-left\" >\n                     <input className=\"input is-small\"  /* ref={register({ required: true })} */ disabled  name=\"order\" value={medication.order} type=\"text\" onChange={ e=> handleQtty(e)} placeholder=\"Quantity\"  />\n                   \n                    {/*  <span className=\"helper is-size-7\"><strong>Instruction: </strong>{medication.instruction}</span> */}\n                    \n                 </p>\n                 <span className=\"helper is-size-7\"><strong>Instructions: </strong></span>\n                 <p>\n                 {medication.instruction}\n                 </p>\n\n             </div> \n            \n             </div>\n             </div>\n             <label className=\"label is-small\">Current Bed: {medication.client.bed}</label>\n                {/*  {!!state.WardModule.selectedWard.sublocations &&<div>\n               \n\n                        <select name=\"bed\" value={chosenBed} onChange={(e)=>handleBed(e)} className=\"selectadd\" >         \n                         <option value=\"\">Choose Bed </option>\n                           {physicalbeds.map((locat,i)=>(\n                               <option key={i} value={locat._id}> {locat.typeName}</option>\n                           ))}\n\n                         </select>\n                     </div>} */}\n\n\n        \n             \n         <div>\n             \n             \n                 <div className=\"field mt-2 is-grouped\">\n                 <p className=\"control\">\n                     <button className=\"button is-success is-small\" /* disabled={!productItem.length>0} */ onClick={handleDischarge}>\n                      Discharge\n                     </button>\n                 </p>\n                {/*  <p className=\"control\">\n                     <button className=\"button is-warning is-small\" disabled={!productItem.length>0} onClick={onSubmit} >\n                         Clear\n                     </button>\n                 </p> */}\n                 </div>\n                 </div>\n            \n             \n             \n             \n             </div>\n             </div>\n             <div className={`modal ${productModal?\"is-active\":\"\"}` }>\n                                    <div className=\"modal-background\"></div>\n                                    <div className=\"modal-card  modalbkgrnd\">\n                                        <header className=\"modal-card-head  btnheight\">\n                                        <p className=\"modal-card-title\">Documentation</p>\n                                        <button className=\"delete\" aria-label=\"close\"  onClick={handlecloseModal}></button>\n                                        </header>\n                                        <section className=\"modal-card-body modalcolor\">\n                                      \n                                         <Encounter standalone=\"true\" />\n                                        </section> \n                                        {/* <footer className=\"modal-card-foot\">\n                                        <button className=\"button is-success\">Save changes</button>\n                                        <button className=\"button\">Cancel</button>\n                                        </footer>  */}\n                                   </div>\n                                </div>      \n         </>\n     )\n    \n }\n\n export  function InventorySearch({getSearchfacility,clear}) {\n    \n    const productServ=client.service('inventory')\n    const [facilities,setFacilities]=useState([])\n     // eslint-disable-next-line\n     const [searchError, setSearchError] =useState(false)\n     // eslint-disable-next-line\n    const [showPanel, setShowPanel] =useState(false)\n     // eslint-disable-next-line\n   const [searchMessage, setSearchMessage] = useState(\"\") \n   // eslint-disable-next-line \n   const [simpa,setSimpa]=useState(\"\")\n   // eslint-disable-next-line \n   const [chosen,setChosen]=useState(false)\n   // eslint-disable-next-line \n   const [count,setCount]=useState(0)\n   const inputEl=useRef(null)\n   const [val,setVal]=useState(\"\")\n   const {user} = useContext(UserContext) \n   const {state}=useContext(ObjectContext)\n    const [productModal,setProductModal]=useState(false)\n\n   const handleRow= async(obj)=>{\n        await setChosen(true)\n        //alert(\"something is chaning\")\n       getSearchfacility(obj)\n       \n       await setSimpa(obj.name)\n       \n        // setSelectedFacility(obj)\n        setShowPanel(false)\n        await setCount(2)\n        /* const    newfacilityModule={\n            selectedFacility:facility,\n            show :'detail'\n        }\n   await setState((prevstate)=>({...prevstate, facilityModule:newfacilityModule})) */\n   //console.log(state)\n    }\n    const handleBlur=async(e)=>{\n        /*  if (count===2){\n             console.log(\"stuff was chosen\")\n         }\n        */\n       /*  console.log(\"blur\")\n         setShowPanel(false)\n        console.log(JSON.stringify(simpa))\n        if (simpa===\"\"){\n            console.log(facilities.length)\n            setSimpa(\"abc\")\n            setSimpa(\"\")\n            setFacilities([])\n            inputEl.current.setValue=\"\"\n        }\n        console.log(facilities.length)\n        console.log(inputEl.current) */\n    }\n    const handleSearch=async(value)=>{\n        setVal(value)\n        if (value===\"\"){\n            setShowPanel(false)\n            getSearchfacility(false)\n            return\n        }\n        const field='name' //field variable\n\n       \n        if (value.length>=3 ){\n            productServ.find({query: {     //service\n                 [field]: {\n                     $regex:value,\n                     $options:'i'\n                    \n                 },\n                 facility: user.currentEmployee.facilityDetail._id,\n                 storeId: state.StoreModule.selectedStore._id,\n                 $limit:10,\n                 $sort: {\n                     createdAt: -1\n                   }\n                     }}).then((res)=>{\n            //  console.log(\"product  fetched successfully\") \n            //  console.log(res.data) \n                setFacilities(res.data)\n                 setSearchMessage(\" product  fetched successfully\")\n                 setShowPanel(true)\n             })\n             .catch((err)=>{\n                toast({\n                    message: 'Error creating ProductEntry ' + err,\n                    type: 'is-danger',\n                    dismissible: true,\n                    pauseOnHover: true,\n                  })\n             })\n         }\n        else{\n           // console.log(\"less than 3 \")\n           // console.log(val)\n            setShowPanel(false)\n            await setFacilities([])\n           // console.log(facilities)\n        }\n    }\n\n    const handleAddproduct =()=>{\n        setProductModal(true) \n    }\n    const handlecloseModal =()=>{\n        setProductModal(false)\n        handleSearch(val)\n    }\n    useEffect(() => {\n       if (clear){\n         //  console.log(\"success has changed\",clear)\n           setSimpa(\"\")\n       }\n        return () => {\n            \n        }\n    }, [clear] )\n    return (\n        <div>\n            <div className=\"field\">\n                <div className=\"control has-icons-left  \">\n                    <div className={`dropdown ${showPanel?\"is-active\":\"\"}`} style={{width:\"100%\"}}>\n                        <div className=\"dropdown-trigger\" style={{width:\"100%\"}}>\n                            <DebounceInput className=\"input is-small  is-expanded\" \n                                type=\"text\" placeholder=\"Search Product\"\n                                value={simpa}\n                                minLength={3}\n                                debounceTimeout={400}\n                                onBlur={(e)=>handleBlur(e)}\n                                onChange={(e)=>handleSearch(e.target.value)}\n                                inputRef={inputEl}\n                                  />\n                            <span className=\"icon is-small is-left\">\n                                <i className=\"fas fa-search\"></i>\n                            </span>\n                        </div>\n                        {/* {searchError&&<div>{searchMessage}</div>} */}\n                        <div className=\"dropdown-menu expanded\" style={{width:\"100%\"}}>\n                            <div className=\"dropdown-content\">\n                          { facilities.length>0?\"\":<div className=\"dropdown-item\" /* onClick={handleAddproduct} */> <span> {val} is not in your inventory</span> </div>}\n\n                              {facilities.map((facility, i)=>(\n                                    \n                                    <div className=\"dropdown-item\" key={facility._id} onClick={()=>handleRow(facility)}>\n                                        \n                                        <div><span>{facility.name}</span></div>\n                                        <div><span><strong>{facility.quantity}</strong></span>\n                                        <span>{facility.baseunit}(s) remaining</span>\n                                        <span className=\"padleft\"><strong>Price:</strong> N{facility.sellingprice}</span></div>\n                                        \n                                    </div>\n                                    \n                                    ))}\n                                    \n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            \n        </div>\n    )\n}"]},"metadata":{},"sourceType":"module"}