{"ast":null,"code":"import{Fragment as _Fragment}from\"react/jsx-runtime\";import _regeneratorRuntime from\"/home/mfybaby/Documents/HealthStack2/HS-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/home/mfybaby/Documents/HealthStack2/HS-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/home/mfybaby/Documents/HealthStack2/HS-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/mfybaby/Documents/HealthStack2/HS-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";/* eslint-disable */import React,{useState,useContext,useEffect,useRef}from'react';import client from'../../feathers';import{DebounceInput}from'react-debounce-input';import{useForm}from\"react-hook-form\";//import {useHistory} from 'react-router-dom'\nimport{UserContext,ObjectContext}from'../../context';import{toast}from'bulma-toast';import{format,formatDistanceToNowStrict}from'date-fns';import PaymentCreate from'./PaymentCreate';import PatientProfile from'../ClientMgt/PatientProfile';/* import {ProductCreate} from './Products' */ // eslint-disable-next-line\n//const searchfacility={};\nimport{Accordion,AccordionItem,AccordionItemHeading,AccordionItemState,AccordionItemButton,AccordionItemPanel}from'react-accessible-accordion';// Demo styles, see 'Styles' section below for some notes on use.\nimport'react-accessible-accordion/dist/fancy-example.css';import{BillingList}from'./Payment';import BillServiceCreate from'./BillServiceCreate';export default function BillService(){return/*#__PURE__*/_jsx(\"section\",{className:\"section remPadTop\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"columns \",children:[/*#__PURE__*/_jsx(\"div\",{className:\"column is-5 \",children:/*#__PURE__*/_jsx(BillsList,{})}),/*#__PURE__*/_jsx(\"div\",{className:\"column is-7 \",children:/*#__PURE__*/_jsx(BillServiceCreate,{})})]})});}export function BillsList(){// const { register, handleSubmit, watch, errors } = useForm();\n// eslint-disable-next-line\nvar _useState=useState(false),_useState2=_slicedToArray(_useState,2),error=_useState2[0],setError=_useState2[1];// eslint-disable-next-line\nvar _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),success=_useState4[0],setSuccess=_useState4[1];// eslint-disable-next-line\nvar _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),message=_useState6[0],setMessage=_useState6[1];var BillServ=client.service('bills');//const history = useHistory()\n// const {user,setUser} = useContext(UserContext)\nvar _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),facilities=_useState8[0],setFacilities=_useState8[1];// eslint-disable-next-line\nvar _useState9=useState(),_useState10=_slicedToArray(_useState9,2),selectedDispense=_useState10[0],setSelectedDispense=_useState10[1];//\nvar _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),selectedOrders=_useState12[0],setSelectedOrders=_useState12[1];// eslint-disable-next-line\nvar _useContext=useContext(ObjectContext),state=_useContext.state,setState=_useContext.setState;// eslint-disable-next-line\nvar _useContext2=useContext(UserContext),user=_useContext2.user,setUser=_useContext2.setUser;var _useState13=useState(\"\"),_useState14=_slicedToArray(_useState13,2),selectedFinance=_useState14[0],setSelectedFinance=_useState14[1];var _useState15=useState(\"\"),_useState16=_slicedToArray(_useState15,2),expanded=_useState16[0],setExpanded=_useState16[1];var _useState17=useState(\"\"),_useState18=_slicedToArray(_useState17,2),oldClient=_useState18[0],setOldClient=_useState18[1];var handleSelectedClient=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(Client){var newClientModule;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:// await setSelectedClient(Client)\nnewClientModule={selectedClient:Client,show:'detail'};_context.next=3;return setState(function(prevstate){return _objectSpread(_objectSpread({},prevstate),{},{ClientModule:newClientModule});});case 3:case\"end\":return _context.stop();}}},_callee);}));return function handleSelectedClient(_x){return _ref.apply(this,arguments);};}();var handleChoseClient=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(client,e,order){var newClient,newProductEntryModule;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setOldClient(client.clientname);newClient=client.clientname;if(oldClient!==newClient){//alert(\"New Client Onboard\")\n//remove all checked clientsly\nselectedOrders.forEach(function(el){return el.checked=\"\";});setSelectedOrders([]);}// console.log(e.target.checked)\norder.checked=e.target.checked;_context2.next=6;return handleSelectedClient(order.participantInfo.client);case 6:_context2.next=8;return setSelectedFinance(order);case 8:newProductEntryModule={selectedFinance:order,show:'detail',state:e.target.checked};_context2.next=11;return setState(function(prevstate){return _objectSpread(_objectSpread({},prevstate),{},{financeModule:newProductEntryModule});});case 11:if(!e.target.checked){_context2.next=16;break;}_context2.next=14;return setSelectedOrders(function(prevstate){return prevstate.concat(order);});case 14:_context2.next=17;break;case 16:setSelectedOrders(function(prevstate){return prevstate.filter(function(el){return el._id!==order._id;});});case 17:case\"end\":return _context2.stop();}}},_callee2);}));return function handleChoseClient(_x2,_x3,_x4){return _ref2.apply(this,arguments);};}();var handleMedicationRow=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(ProductEntry,e){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:case\"end\":return _context3.stop();}}},_callee3);}));return function handleMedicationRow(_x5,_x6){return _ref3.apply(this,arguments);};}();var handleCreateNew=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var newProductEntryModule;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:newProductEntryModule={selectedDispense:{},show:'create'};_context4.next=3;return setState(function(prevstate){return _objectSpread(_objectSpread({},prevstate),{},{DispenseModule:newProductEntryModule});});case 3:case\"end\":return _context4.stop();}}},_callee4);}));return function handleCreateNew(){return _ref4.apply(this,arguments);};}();var handleSearch=function handleSearch(val){var field='name';//console.log(val)\nBillServ.find({query:{'participantInfo.paymentmode.detail.principalName':{$regex:val,$options:'i'},$or:[{'participantInfo.paymentmode.type':\"Cash\"},{'participantInfo.paymentmode.type':\"Family Cover\"}],'participantInfo.billingFacility':user.currentEmployee.facilityDetail._id,billing_status:\"Unpaid\",// need to set this finally\n//order_category:\"Prescription\",\n// storeId:state.StoreModule.selectedStore._id,\n//facility:user.currentEmployee.facilityDetail._id || \"\",\n$limit:30,$sort:{createdAt:-1}}}).then(function(res){// console.log(res)\nsetFacilities(res.groupedOrder);setMessage(\" ProductEntry  fetched successfully\");setSuccess(true);}).catch(function(err){// console.log(err)\nsetMessage(\"Error fetching ProductEntry, probable network issues \"+err);setError(true);});};var getFacilities=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){var findProductEntry;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return BillServ.find({query:{$or:[{'participantInfo.paymentmode.type':\"Cash\"},{'participantInfo.paymentmode.type':\"Family Cover\"}],'participantInfo.billingFacility':user.currentEmployee.facilityDetail._id,billing_status:\"Unpaid\",// need to set this finally\n//storeId:state.StoreModule.selectedStore._id,\n//clientId:state.ClientModule.selectedClient._id,\n$limit:100,$sort:{createdAt:-1}}});case 2:findProductEntry=_context5.sent;console.log(\"updatedorder\",findProductEntry.groupedOrder);_context5.next=6;return setFacilities(findProductEntry.groupedOrder);case 6:case\"end\":return _context5.stop();}}},_callee5);}));return function getFacilities(){return _ref5.apply(this,arguments);};}();var handleRow=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(Client,e){return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:case\"end\":return _context6.stop();}}},_callee6);}));return function handleRow(_x7,_x8){return _ref6.apply(this,arguments);};}();//1.consider using props for global data\nuseEffect(function(){// console.log(\"started\")\ngetFacilities();BillServ.on('created',function(obj){return getFacilities();});BillServ.on('updated',function(obj){return getFacilities();});BillServ.on('patched',function(obj){return getFacilities();});BillServ.on('removed',function(obj){return getFacilities();});var newClient={selectedClient:\"\",show:'create'};setState(function(prevstate){return _objectSpread(_objectSpread({},prevstate),{},{ClientModule:newClient});});return function(){};},[]);useEffect(function(){//changes with checked box\n// console.log(selectedOrders)\nreturn function(){};},[selectedOrders]);useEffect(function(){if(state.financeModule.show===\"create\"){selectedOrders.forEach(function(el){return el.checked=\"\";});setSelectedOrders([]);}return function(){};},[state.financeModule.show]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"level\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"level-left\",children:/*#__PURE__*/_jsx(\"div\",{className:\"level-item\",children:/*#__PURE__*/_jsx(\"div\",{className:\"field\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"control has-icons-left  \",children:[/*#__PURE__*/_jsx(DebounceInput,{className:\"input is-small \",type:\"text\",placeholder:\"Search Medications\",minLength:3,debounceTimeout:400,onChange:function onChange(e){return handleSearch(e.target.value);}}),/*#__PURE__*/_jsx(\"span\",{className:\"icon is-small is-left\",children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-search\"})})]})})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"level-item\",children:[\" \",/*#__PURE__*/_jsx(\"span\",{className:\"is-size-6 has-text-weight-medium\",children:\"Unpaid Bills \"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"level-right\",children:/*#__PURE__*/_jsx(\"div\",{className:\"level-item\",children:/*#__PURE__*/_jsx(\"div\",{className:\"level-item\",children:/*#__PURE__*/_jsx(\"div\",{className:\"button is-success is-small\",onClick:handleCreateNew,children:\"New\"})})})})]}),/*#__PURE__*/_jsx(\"div\",{className:\" pullup \",children:/*#__PURE__*/_jsx(\"div\",{className:\" is-fullwidth vscrollable pr-1\",children:/*#__PURE__*/_jsx(Accordion,{allowZeroExpanded:true,children:facilities.map(function(Clinic,i){return/*#__PURE__*/_jsxs(AccordionItem,{children:[/*#__PURE__*/_jsx(AccordionItemHeading,{children:/*#__PURE__*/_jsx(AccordionItemButton,{children:/*#__PURE__*/_jsxs(\"strong\",{children:[\" \",i+1,\" \",Clinic.clientname,\" \",\" \"]})})}),/*#__PURE__*/_jsx(AccordionItemPanel,{children:/*#__PURE__*/_jsx(\"div\",{className:\" is-fullwidth vscrollable pr-1\",children:/*#__PURE__*/_jsx(Accordion,{allowZeroExpanded:true,children:Clinic.bills.map(function(category,i){return/*#__PURE__*/_jsxs(AccordionItem,{children:[/*#__PURE__*/_jsx(AccordionItemHeading,{children:/*#__PURE__*/_jsxs(AccordionItemButton,{children:[category.catName,\" with \",category.order.length,\" Unpaid bills. \"]})}),/*#__PURE__*/_jsx(AccordionItemPanel,{children:/*#__PURE__*/_jsxs(\"table\",{className:\"table is-striped  is-hoverable is-fullwidth is-scrollable mr-2\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:/*#__PURE__*/_jsx(\"abbr\",{title:\"Serial No\",children:\"S/No\"})}),/*#__PURE__*/_jsx(\"th\",{children:/*#__PURE__*/_jsx(\"abbr\",{title:\"Date\",children:\"Date\"})}),/*#__PURE__*/_jsx(\"th\",{children:/*#__PURE__*/_jsx(\"abbr\",{title:\"Description\",children:\"Description\"})}),/*#__PURE__*/_jsx(\"th\",{children:/*#__PURE__*/_jsx(\"abbr\",{title:\"Status\",children:\"Status\"})}),/*#__PURE__*/_jsx(\"th\",{children:/*#__PURE__*/_jsx(\"abbr\",{title:\"Amount\",children:\"Amount\"})})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:category.order.map(function(order,i){return/*#__PURE__*/_jsxs(\"tr\",{/*  onClick={()=>handleMedicationRow(order)} */className:order._id===((selectedFinance===null||selectedFinance===void 0?void 0:selectedFinance._id)||null)?\"is-selected\":\"\",children:[/*#__PURE__*/_jsxs(\"th\",{children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",name:order._id,onChange:function onChange(e){return handleChoseClient(Clinic,e,order);},checked:order.checked}),\"  \",i+1]}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"span\",{children:format(new Date(order.createdAt),'dd-MM-yy')})}),\" \",/*#__PURE__*/_jsx(\"th\",{children:order.serviceInfo.name}),/*#__PURE__*/_jsx(\"td\",{children:order.billing_status}),/*#__PURE__*/_jsx(\"td\",{children:order.serviceInfo.amount})]},order._id);})})]})})]},i);})})})})]},Clinic.client_id);})})})})]});}","map":{"version":3,"sources":["/home/mfybaby/Documents/HealthStack2/HS-frontend/src/components/Finance/BillService.js"],"names":["React","useState","useContext","useEffect","useRef","client","DebounceInput","useForm","UserContext","ObjectContext","toast","format","formatDistanceToNowStrict","PaymentCreate","PatientProfile","Accordion","AccordionItem","AccordionItemHeading","AccordionItemState","AccordionItemButton","AccordionItemPanel","BillingList","BillServiceCreate","BillService","BillsList","error","setError","success","setSuccess","message","setMessage","BillServ","service","facilities","setFacilities","selectedDispense","setSelectedDispense","selectedOrders","setSelectedOrders","state","setState","user","setUser","selectedFinance","setSelectedFinance","expanded","setExpanded","oldClient","setOldClient","handleSelectedClient","Client","newClientModule","selectedClient","show","prevstate","ClientModule","handleChoseClient","e","order","clientname","newClient","forEach","el","checked","target","participantInfo","newProductEntryModule","financeModule","concat","filter","_id","handleMedicationRow","ProductEntry","handleCreateNew","DispenseModule","handleSearch","val","field","find","query","$regex","$options","$or","currentEmployee","facilityDetail","billing_status","$limit","$sort","createdAt","then","res","groupedOrder","catch","err","getFacilities","findProductEntry","console","log","handleRow","on","obj","value","map","Clinic","i","bills","category","catName","length","Date","serviceInfo","name","amount","client_id"],"mappings":"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","sourcesContent":["/* eslint-disable */\nimport React, {useState,useContext, useEffect,useRef} from 'react'\nimport client from '../../feathers'\nimport {DebounceInput} from 'react-debounce-input';\nimport { useForm } from \"react-hook-form\";\n//import {useHistory} from 'react-router-dom'\nimport {UserContext,ObjectContext} from '../../context'\nimport {toast} from 'bulma-toast'\nimport {format, formatDistanceToNowStrict } from 'date-fns'\nimport PaymentCreate from './PaymentCreate'\nimport PatientProfile from '../ClientMgt/PatientProfile'\n/* import {ProductCreate} from './Products' */\n// eslint-disable-next-line\n//const searchfacility={};\nimport {\n    Accordion,\n    AccordionItem,\n    AccordionItemHeading,\n    AccordionItemState,\n    AccordionItemButton,\n    AccordionItemPanel,\n} from 'react-accessible-accordion';\n\n// Demo styles, see 'Styles' section below for some notes on use.\nimport 'react-accessible-accordion/dist/fancy-example.css';\nimport { BillingList } from './Payment'\nimport BillServiceCreate from './BillServiceCreate'\n\nexport default function BillService() {\n    return (\n        <section className= \"section remPadTop\">\n           {/*  <div className=\"level\">\n            <div className=\"level-item\"> <span className=\"is-size-6 has-text-weight-medium\">ProductEntry  Module</span></div>\n            </div> */}\n            <div className=\"columns \">\n                <div className=\"column is-5 \">\n                    <BillsList />\n                    </div>\n              \n                <div className=\"column is-7 \">\n                \n                 <BillServiceCreate />\n                </div>\n               {/*  <div className=\"column is-3 \">\n                \n                {(state.financeModule.show ==='detail')&&<PatientProfile />}\n                </div> */}\n\n            </div>                            \n            </section>\n    )\n}\n\n\nexport function BillsList(){\n    // const { register, handleSubmit, watch, errors } = useForm();\n     // eslint-disable-next-line\n     const [error, setError] =useState(false)\n      // eslint-disable-next-line\n     const [success, setSuccess] =useState(false)\n      // eslint-disable-next-line\n    const [message, setMessage] = useState(\"\") \n    const BillServ=client.service('bills')\n     //const history = useHistory()\n    // const {user,setUser} = useContext(UserContext)\n     const [facilities,setFacilities]=useState([])\n      // eslint-disable-next-line\n    const [selectedDispense, setSelectedDispense]=useState() //\n    const [selectedOrders, setSelectedOrders]=useState([]) \n     // eslint-disable-next-line\n     const {state,setState}=useContext(ObjectContext)\n     // eslint-disable-next-line\n     const {user,setUser}=useContext(UserContext)\n     const [selectedFinance, setSelectedFinance] =useState(\"\")\n     const [expanded, setExpanded] =useState(\"\")\n     const [oldClient, setOldClient] =useState(\"\")\n \n     const handleSelectedClient= async(Client)=>{\n         // await setSelectedClient(Client)\n          const    newClientModule={\n              selectedClient:Client,\n              show :'detail'\n          }\n         await setState((prevstate)=>({...prevstate, ClientModule:newClientModule}))\n      }\n \n     const handleChoseClient= async(client,e, order)=>{\n         setOldClient(client.clientname)\n         let newClient=client.clientname\n         if(oldClient!==newClient){\n             //alert(\"New Client Onboard\")\n             //remove all checked clientsly\n             selectedOrders.forEach(el=>el.checked=\"\")\n             setSelectedOrders([])\n         }\n \n        // console.log(e.target.checked)\n         order.checked=e.target.checked\n         await handleSelectedClient(order.participantInfo.client)\n         //handleMedicationRow(order)\n         await setSelectedFinance(order)\n         const    newProductEntryModule={\n             selectedFinance:order,\n             show :'detail',\n             state:e.target.checked\n         }\n       await setState((prevstate)=>({...prevstate, financeModule:newProductEntryModule}))\n       \n       //set of checked items\n       if (e.target.checked){\n         await setSelectedOrders((prevstate)=>(prevstate.concat(order)))\n       }else{\n         setSelectedOrders( prevstate=>prevstate.filter(el=>el._id!==order._id))\n       }\n     \n        // console.log(selectedOrders)\n     }\n     const handleMedicationRow= async(ProductEntry,e)=>{ //handle selected single order\n         //console.log(\"b4\",state)\n        // alert(\"Header touched\")\n     \n         //console.log(\"handlerow\",ProductEntry)\n        /* alert(ProductEntry.checked)*/\n        /*  ProductEntry.checked=!ProductEntry.checked */\n     \n        /*  await setSelectedFinance(ProductEntry)\n     \n         const    newProductEntryModule={\n             selectedFinance:ProductEntry,\n             show :'detail'\n \n         }\n       await setState((prevstate)=>({...prevstate, financeModule:newProductEntryModule})) */\n        //console.log(state)\n       // ProductEntry.show=!ProductEntry.show\n     \n     }\n \n     const handleCreateNew = async()=>{\n         const    newProductEntryModule={\n             selectedDispense:{},\n             show :'create'\n             }\n        await setState((prevstate)=>({...prevstate, DispenseModule:newProductEntryModule}))\n        //console.log(state)\n         \n \n     }\n   \n \n     const handleSearch=(val)=>{\n        const field='name'\n        //console.log(val)\n        BillServ.find({query: {\n            'participantInfo.paymentmode.detail.principalName': {\n                     $regex:val,\n                     $options:'i'\n                    \n                 },\n                \n                 $or:[\n                    {\n                       'participantInfo.paymentmode.type':\"Cash\"\n                    },\n                    {\n                       'participantInfo.paymentmode.type':\"Family Cover\"\n                    }\n\n                ],\n                \n                'participantInfo.billingFacility': user.currentEmployee.facilityDetail._id,\n                billing_status:\"Unpaid\",  // need to set this finally\n                 //order_category:\"Prescription\",\n                // storeId:state.StoreModule.selectedStore._id,\n                //facility:user.currentEmployee.facilityDetail._id || \"\",\n                 $limit:30,\n                 $sort: {\n                     createdAt: -1\n                   }\n                     }}).then((res)=>{\n                // console.log(res)\n                setFacilities(res.groupedOrder)\n                 setMessage(\" ProductEntry  fetched successfully\")\n                 setSuccess(true) \n             })\n             .catch((err)=>{\n                // console.log(err)\n                 setMessage(\"Error fetching ProductEntry, probable network issues \"+ err )\n                 setError(true)\n             })\n         }\n     const getFacilities= async()=>{\n        \n             // console.log(\"here b4 server\")\n     const findProductEntry= await BillServ.find(\n             {query: {\n                 $or:[\n                     {\n                        'participantInfo.paymentmode.type':\"Cash\"\n                     },\n                     {\n                        'participantInfo.paymentmode.type':\"Family Cover\"\n                     }\n\n                 ],\n                 \n                 'participantInfo.billingFacility': user.currentEmployee.facilityDetail._id,\n                 billing_status:\"Unpaid\",  // need to set this finally\n                 //storeId:state.StoreModule.selectedStore._id,\n                 //clientId:state.ClientModule.selectedClient._id,\n                 $limit:100,\n                 $sort: {\n                     createdAt: -1\n                 }\n                 }})\n \n             console.log(\"updatedorder\", findProductEntry.groupedOrder)\n             await setFacilities(findProductEntry.groupedOrder)\n           //  await setState((prevstate)=>({...prevstate, currentClients:findProductEntry.groupedOrder}))\n             }   \n     const handleRow= async(Client,e)=>{\n            // alert(expanded)\n               \n             }\n     //1.consider using props for global data\n     useEffect(() => {\n         // console.log(\"started\")\n             getFacilities()\n             BillServ.on('created', (obj)=>getFacilities())\n             BillServ.on('updated', (obj)=>getFacilities())\n             BillServ.on('patched', (obj)=>getFacilities())\n             BillServ.on('removed', (obj)=>getFacilities())\n\n             const newClient={\n                selectedClient:\"\",\n                show :'create'\n                }\n             setState((prevstate)=>({...prevstate, ClientModule:newClient}))\n\n             return () => {\n             \n             }\n             },[])\n \n     useEffect(() => {\n         //changes with checked box\n        // console.log(selectedOrders)\n         \n         return () => {\n             \n         }\n     }, [selectedOrders])\n \n     useEffect(() => {\n        if (state.financeModule.show===\"create\"){\n         selectedOrders.forEach(el=>el.checked=\"\")\n         setSelectedOrders([])\n \n        }\n         return () => {\n            \n         }\n     }, [state.financeModule.show])\n    \n  \n \n     return(     \n             <>  \n                 <div className=\"level\">\n                     <div className=\"level-left\">\n                         <div className=\"level-item\">\n                             <div className=\"field\">\n                                 <p className=\"control has-icons-left  \">\n                                     <DebounceInput className=\"input is-small \" \n                                         type=\"text\" placeholder=\"Search Medications\"\n                                         minLength={3}\n                                         debounceTimeout={400}\n                                         onChange={(e)=>handleSearch(e.target.value)} />\n                                     <span className=\"icon is-small is-left\">\n                                         <i className=\"fas fa-search\"></i>\n                                     </span>\n                                 </p>\n                             </div>\n                         </div>\n                     </div>\n                     <div className=\"level-item\"> <span className=\"is-size-6 has-text-weight-medium\">Unpaid Bills </span></div>\n                     <div className=\"level-right\">\n                        <div className=\"level-item\"> \n                             <div className=\"level-item\"><div className=\"button is-success is-small\" onClick={handleCreateNew}>New</div></div>\n                         </div> \n                     </div>\n \n                 </div>\n                 <div className=\" pullup \">\n                     <div className=\" is-fullwidth vscrollable pr-1\">   \n                     <Accordion allowZeroExpanded >\n                         {facilities.map((Clinic, i)=>(\n                             <AccordionItem  key={Clinic.client_id}  >\n                                <AccordionItemHeading >\n                                     <AccordionItemButton  >\n                                     {/* <input type = \"checkbox\" name={Clinic.client_id}  />   */}\n                                     <strong> {i+1} {Clinic.clientname} {/* with {Clinic.bills.length} Unpaid bills. */} {/* Grand Total amount: N */}</strong> \n                                     </AccordionItemButton>\n                                 </AccordionItemHeading>\n                                 <AccordionItemPanel>\n                                     <div className=\" is-fullwidth vscrollable pr-1\">   \n                                         <Accordion allowZeroExpanded>\n                                             {Clinic.bills.map((category, i)=>(\n                                                 <AccordionItem  key={i} >\n                                                     <AccordionItemHeading >\n                                                     <AccordionItemButton  >\n                                                     {/* <input type = \"checkbox\" name={Clinic.client_id} onChange={(e)=>handleMedicationRow(Clinic,e)} /> */}  \n                                                          {category.catName} with {category.order.length} Unpaid bills. {/* Total amount: N */}\n                                                     </AccordionItemButton>\n                                                     </AccordionItemHeading>\n                                                     <AccordionItemPanel>\n                                                         <table className=\"table is-striped  is-hoverable is-fullwidth is-scrollable mr-2\">\n                                                                 <thead>\n                                                                     <tr>\n                                                                         <th><abbr title=\"Serial No\">S/No</abbr></th>\n                                                                         <th><abbr title=\"Date\">Date</abbr></th>\n                                                                         <th><abbr title=\"Description\">Description</abbr></th>\n                                                                     {/*  <th>Fulfilled</th> */}\n                                                                         <th><abbr title=\"Status\">Status</abbr></th>\n                                                                         <th><abbr title=\"Amount\">Amount</abbr></th>\n                                                                     </tr>\n                                                                 </thead>\n                                                                 <tbody>\n                                                      { category.order.map((order, i)=>(\n \n                                                         <tr key={order._id}  /*  onClick={()=>handleMedicationRow(order)} */  className={order._id===(selectedFinance?._id||null)?\"is-selected\":\"\"}>                                         \n                                                         <th><input type = \"checkbox\" name={order._id} onChange={(e)=>handleChoseClient(Clinic,e, order)}  checked={order.checked}/>  {i+1}</th>\n                                                         <td><span>{format(new Date(order.createdAt),'dd-MM-yy')}</span></td> {/* {formatDistanceToNowStrict(new Date(ProductEntry.createdAt),{addSuffix: true})} <br/> */} \n                                                         <th>{order.serviceInfo.name}</th>\n                                                        {/*  <td>{order.fulfilled===\"True\"?\"Yes\":\"No\"}</td> */}\n                                                         <td>{order.billing_status}</td>\n                                                         <td>{order.serviceInfo.amount}</td>\n                                                         </tr>\n                                                 ))}\n                                             </tbody>\n                                             </table>\n \n                                                     </AccordionItemPanel>                                          \n                                                 </AccordionItem>\n                                             ))}\n                                         </Accordion>\n                                     </div>\n                                 </AccordionItemPanel>                    \n                             </AccordionItem >\n                         ))}\n                     </Accordion >\n                     </div>  \n                 </div>\n             </>          \n     )\n     }\n\n\n"]},"metadata":{},"sourceType":"module"}